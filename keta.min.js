"use strict";angular.module("keta",["keta.directives.AppBar","keta.directives.ExtendedTable","keta.directives.MainMenu","keta.directives.Sidebar","keta.filters.OrderObjectBy","keta.filters.Slice","keta.filters.Unit","keta.services.AccessToken","keta.services.AppContext","keta.services.ApplicationSet","keta.services.Application","keta.services.DeviceEvent","keta.services.DeviceSet","keta.services.Device","keta.services.EventBusDispatcher","keta.services.EventBusManager","keta.services.EventBus","keta.services.Logger","keta.services.TagSet","keta.services.Tag","keta.services.UserSet","keta.services.User","keta.utils.Application","keta.utils.Common"]),angular.module("keta.directives.AppBar",["keta.directives.Sidebar","keta.services.EventBusManager","keta.services.Device","keta.services.DeviceSet","keta.services.ApplicationSet","keta.services.User","keta.utils.Common"]).constant("AppBarConstants",{COMPONENT:{WORLD_SWITCHER:"worldSwitcher",MENU_BAR_TOGGLE:"menuBarToggle",NOTIFICATION_BAR_TOGGLE:"notificationBarToggle",APP_TITLE:"appTitle",USER_MENU:"userMenu",LANGUAGE_MENU:"languageMenu",ENERGY_MANAGER_MENU:"energyManagerMenu",COMPACT_MENU:"compactMenu"},SIZE:{XXS:"xxs",XS:"xs",SM:"sm",MD:"md",LG:"lg"},STATE:{HIDDEN:"hidden",FULL:"full",COMPACT:"compact"},ROOT_APP_ID:"kiwigrid.clouddesktop"}).constant("AppBarMessageKeys",{en:{"__keta.directives.AppBar_app_title":"Application","__keta.directives.AppBar_all_apps":"All Apps","__keta.directives.AppBar_all_energy_managers":"All Energy-Managers","__keta.directives.AppBar_energy_manager":"Energy-Manager","__keta.directives.AppBar_user_logout":"Logout","__keta.directives.AppBar_user_profile":"User Account"},de:{"__keta.directives.AppBar_app_title":"Applikation","__keta.directives.AppBar_all_apps":"Alle Apps","__keta.directives.AppBar_all_energy_managers":"Alle Energy-Manager","__keta.directives.AppBar_energy_manager":"Energy-Manager","__keta.directives.AppBar_user_logout":"Abmelden","__keta.directives.AppBar_user_profile":"Benutzerkonto"}}).directive("appBar",function($rootScope,$window,$document,$timeout,$filter,EventBusManager,DeviceSet,ApplicationSet,User,AppBarConstants,AppBarMessageKeys,DeviceConstants,SidebarConstants,CommonUtils){return{restrict:"EA",replace:!0,scope:{eventBusId:"=?",locales:"=?",currentLocale:"=?",labels:"=?",links:"=?",worlds:"=?",displayModes:"=?",rootApp:"=?"},transclude:!0,templateUrl:"/components/directives/app-bar.html",link:function(scope,element){scope.user={},scope.menus={},scope.worlds=scope.worlds||[],scope.locales=scope.locales||[],scope.energyManagers=[],scope.locales=$filter("orderBy")(scope.locales,"name"),scope.eventBusId=scope.eventBusId||"kiwibus";var eventBus=EventBusManager.get(scope.eventBusId),STATES=AppBarConstants.STATE,SIZES=AppBarConstants.SIZE,DEFAULT_CONTAINER_HEIGHT=120;scope.MENU_ELEMENTS=AppBarConstants.COMPONENT;var DECIMAL_RADIX=10,HIDDEN_CLASS_PREFIX="hidden-",VISIBLE_CLASS_PREFIX="visible-",sizesFullState={};sizesFullState[SIZES.XXS]=STATES.FULL,sizesFullState[SIZES.XS]=STATES.FULL,sizesFullState[SIZES.SM]=STATES.FULL,sizesFullState[SIZES.MD]=STATES.FULL,sizesFullState[SIZES.LG]=STATES.FULL;var sizesDefaultState={};sizesDefaultState[SIZES.XXS]=STATES.HIDDEN,sizesDefaultState[SIZES.XS]=STATES.HIDDEN,sizesDefaultState[SIZES.SM]=STATES.COMPACT,sizesDefaultState[SIZES.MD]=STATES.COMPACT,sizesDefaultState[SIZES.LG]=STATES.FULL;var defaultDisplayModes={};defaultDisplayModes[scope.MENU_ELEMENTS.WORLD_SWITCHER]=sizesFullState,defaultDisplayModes[scope.MENU_ELEMENTS.MENU_BAR_TOGGLE]=sizesFullState,defaultDisplayModes[scope.MENU_ELEMENTS.NOTIFICATION_BAR_TOGGLE]=sizesFullState,defaultDisplayModes[scope.MENU_ELEMENTS.APP_TITLE]=sizesFullState,defaultDisplayModes[scope.MENU_ELEMENTS.USER_MENU]=sizesDefaultState,defaultDisplayModes[scope.MENU_ELEMENTS.ENERGY_MANAGER_MENU]=sizesDefaultState,defaultDisplayModes[scope.MENU_ELEMENTS.LANGUAGE_MENU]=sizesDefaultState,defaultDisplayModes[scope.MENU_ELEMENTS.COMPACT_MENU]={},defaultDisplayModes[scope.MENU_ELEMENTS.COMPACT_MENU][SIZES.XXS]=STATES.COMPACT,defaultDisplayModes[scope.MENU_ELEMENTS.COMPACT_MENU][SIZES.XS]=STATES.COMPACT,defaultDisplayModes[scope.MENU_ELEMENTS.COMPACT_MENU][SIZES.SM]=STATES.HIDDEN,defaultDisplayModes[scope.MENU_ELEMENTS.COMPACT_MENU][SIZES.MD]=STATES.HIDDEN,defaultDisplayModes[scope.MENU_ELEMENTS.COMPACT_MENU][SIZES.LG]=STATES.HIDDEN;var isMenuVisible=function(menuElement){var isVisible=!1;return angular.forEach(SIZES,function(size){scope.displayModes[menuElement][size]!==STATES.HIDDEN&&(isVisible=!0)}),isVisible},mergeObjects=function mergeObjects(customObject,defaultObject){var value,result={};for(value in customObject)value in defaultObject&&"object"==typeof customObject[value]&&null!==value?result[value]=mergeObjects(customObject[value],defaultObject[value]):result[value]=customObject[value];for(value in defaultObject)value in result||(result[value]=defaultObject[value]);return result};scope.displayModes=mergeObjects(scope.displayModes,defaultDisplayModes);var scrollContainerHeight=DEFAULT_CONTAINER_HEIGHT,container=element,navbarFirst=container.children()[0],navbarSecond=container.children()[1],navbarFirstHeight=0,navbarSecondHeight=0,navbarSecondMarginBottom=0;$timeout(function(){navbarFirstHeight=navbarFirst.offsetHeight,navbarSecondHeight=navbarSecond.offsetHeight,navbarSecondMarginBottom=parseInt($window.getComputedStyle(navbarSecond,null).getPropertyValue("margin-bottom"),DECIMAL_RADIX),scrollContainerHeight=navbarFirstHeight+navbarSecondHeight+navbarSecondMarginBottom}),scope.currentLocale=scope.currentLocale||"en",scope.MESSAGE_KEY_PREFIX="__keta.directives.AppBar",scope.labels=angular.extend(AppBarMessageKeys,scope.labels),scope.getLabel=function(key){return CommonUtils.getLabelByLocale(key,scope.labels,scope.currentLocale)};var defaultLinks={ALL_APPS:null,ALL_ENERGY_MANAGERS:null,APP_ROOT:null,USER_PROFILE:null,USER_LOGOUT:null};scope.TYPES={ENERGY_MANAGER:"ENERGY_MANAGER"},scope.LIMITS={ENERGY_MANAGER:3};var PREDICATES={ENERGY_MANAGER:{field:"name",reverse:!1}};scope.links=angular.isDefined(scope.links)?angular.extend(defaultLinks,scope.links):defaultLinks;var setDefaultLinks=function(){scope.links.USER_LOGOUT=angular.isString(scope.links.USER_LOGOUT)?scope.links.USER_LOGOUT:"/rest/auth/logout",null!==eventBus&&ApplicationSet.create(eventBus).query().then(function(reply){if(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)){var entryUri=null,name={};scope.rootApp=null,angular.forEach(reply.result.items,function(app){angular.isDefined(app.appId)&&(app.appId===AppBarConstants.ROOT_APP_ID||"kiwigrid.desktop"===app.appId)&&angular.isDefined(app.entryUri)&&(entryUri=app.entryUri,CommonUtils.doesPropertyExist(app,"meta.i18n")&&angular.forEach(Object.keys(app.meta.i18n),function(locale){name[locale]=app.meta.i18n[locale].name}))});var link=document.createElement("a");link.href=entryUri,null!==entryUri&&(scope.rootApp={},scope.rootApp.link=entryUri,scope.rootApp.name=name,scope.worlds.unshift({name:"Desktop",link:scope.rootApp.link})),scope.links.ALL_APPS=angular.isString(scope.links.ALL_APPS)?scope.links.ALL_APPS:link.origin+"/#/applications"+link.search,scope.links.USER_PROFILE=angular.isString(scope.links.USER_PROFILE)?scope.links.USER_PROFILE:link.origin+"/#/user"+link.search,angular.isString(scope.links.ALL_ENERGY_MANAGERS)||(scope.links.ALL_ENERGY_MANAGERS=link.origin+"/#/devices",link.search.length>0?scope.links.ALL_ENERGY_MANAGERS+=link.search+"&":scope.links.ALL_ENERGY_MANAGERS+=link.search+"?",scope.links.ALL_ENERGY_MANAGERS+="deviceClass=com.kiwigrid.devices.em.EnergyManager")}})},allLinkKeysAlreadySet=!0;angular.forEach(Object.keys(defaultLinks),function(linkKey){null===defaultLinks[linkKey]&&(allLinkKeysAlreadySet=!1)}),allLinkKeysAlreadySet===!1&&setDefaultLinks(),scope.getClasses=function(menuName,elementType){var classes=[];return angular.isDefined(elementType)||(elementType="menu"),angular.isDefined(scope.menus[menuName])&&angular.isDefined(scope.menus[menuName].isOpen)&&scope.menus[menuName].isOpen&&classes.push("open"),angular.forEach(SIZES,function(size){var state=scope.displayModes[menuName][size];switch(elementType){case"menu":switch(state){case STATES.HIDDEN:classes.push(HIDDEN_CLASS_PREFIX+size);break;case STATES.FULL:classes.push(VISIBLE_CLASS_PREFIX+size);break;case STATES.COMPACT:classes.push(VISIBLE_CLASS_PREFIX+size)}break;case"label":state===STATES.COMPACT&&classes.push(HIDDEN_CLASS_PREFIX+size)}}),classes.join(" ")};var getDevices=function(){null!==eventBus&&angular.isDefined(scope.user.userId)&&isMenuVisible(scope.MENU_ELEMENTS.ENERGY_MANAGER_MENU)&&DeviceSet.create(eventBus).filter({"deviceModel.deviceClass":{$in:[DeviceConstants.CLASS.ENERGY_MANAGER]},owner:scope.user.userId}).project({tagValues:{IdName:1,SettingsNetworkMap:1}}).query().then(function(reply){if(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)){var energyManagers=[];angular.forEach(reply.result.items,function(item){var emIP=angular.isDefined(item.tagValues)&&angular.isDefined(item.tagValues.SettingsNetworkMap)&&angular.isDefined(item.tagValues.SettingsNetworkMap.value)&&angular.isDefined(item.tagValues.SettingsNetworkMap.value.ipv4)?item.tagValues.SettingsNetworkMap.value.ipv4:null;null!==emIP&&energyManagers.push({name:item.tagValues.IdName.value,link:"http://"+emIP})}),scope.energyManagers=energyManagers}})},getActiveLangEntry=function(){var activeLangEntry=scope.locales[0]||{};return angular.forEach(scope.locales,function(value){value.code===scope.currentLocale&&(activeLangEntry=value)}),activeLangEntry},updateMenus=function(){scope.menus={},scope.menus[scope.MENU_ELEMENTS.COMPACT_MENU]={isOpen:!1},scope.menus[scope.MENU_ELEMENTS.WORLD_SWITCHER]={isOpen:!1},scope.menus[scope.MENU_ELEMENTS.ENERGY_MANAGER_MENU]={isOpen:!1},scope.menus[scope.MENU_ELEMENTS.USER_MENU]={isOpen:!1},scope.menus[scope.MENU_ELEMENTS.LANGUAGE_MENU]={isOpen:!1,activeEntry:getActiveLangEntry()}};updateMenus(),null!==eventBus&&User.getCurrent(eventBus).then(function(reply){scope.user=reply,getDevices()}),scope.order=function(type){var field=angular.isDefined(PREDICATES[type])?PREDICATES[type].field:"name";return function(item){return angular.isDefined(item[field])?item[field]:""}},scope.reverse=function(type){return angular.isDefined(PREDICATES[type])&&angular.isDefined(PREDICATES[type].reverse)?PREDICATES[type].reverse:!1},scope.scrollOverNavbarFirst=!1,angular.element($window).bind("scroll",function(){angular.isDefined(navbarFirst)&&(this.scrollY>navbarFirstHeight?(scope.scrollOverNavbarFirst=!0,element.css("height",scrollContainerHeight+"px")):(scope.scrollOverNavbarFirst=!1,element.css("height","auto")),scope.menus.worldSwitcher.isOpen=!1,scope.$digest())}),scope.toggleOpenState=function(menuName){if(angular.isDefined(scope.menus[menuName])){var currentState=angular.copy(scope.menus[menuName].isOpen);scope.closeAllMenus(),currentState===scope.menus[menuName].isOpen&&(scope.menus[menuName].isOpen=!scope.menus[menuName].isOpen)}},scope.closeAllMenus=function(){scope.menus[scope.MENU_ELEMENTS.WORLD_SWITCHER].isOpen=!1,scope.menus[scope.MENU_ELEMENTS.USER_MENU].isOpen=!1,scope.menus[scope.MENU_ELEMENTS.ENERGY_MANAGER_MENU].isOpen=!1,scope.menus[scope.MENU_ELEMENTS.COMPACT_MENU].isOpen=!1,scope.menus[scope.MENU_ELEMENTS.LANGUAGE_MENU].isOpen=!1},scope.setLocale=function(locale){scope.currentLocale=locale.code,scope.menus[scope.MENU_ELEMENTS.LANGUAGE_MENU].activeEntry=locale,scope.closeAllMenus()},scope.$on("$locationChangeStart",function(){scope.closeAllMenus()}),scope.isActive=function(menuName,entry){return angular.isDefined(scope.menus[menuName])&&scope.menus[menuName].activeEntry===entry},scope.toggleSidebar=function($event,position){$event.stopPropagation(),scope.closeAllMenus(),position===SidebarConstants.POSITION.LEFT?$rootScope.$broadcast(SidebarConstants.EVENT.TOGGLE_SIDEBAR_LEFT):position===SidebarConstants.POSITION.RIGHT&&$rootScope.$broadcast(SidebarConstants.EVENT.TOGGLE_SIDEBAR_RIGHT)},$document.bind("click",function(event){var appBarHtml=element.html(),targetElementHtml=angular.element(event.target).html();-1===appBarHtml.indexOf(targetElementHtml)&&(scope.closeAllMenus(),scope.$digest())}),scope.$watch("energyManagers",function(newValue,oldValue){newValue!==oldValue&&updateMenus()})}}}),angular.module("keta.directives.AppBar").run(function($templateCache){$templateCache.put("/components/directives/app-bar.html",'<div class="navigation-container">	<nav class="navbar navbar-level-1 brand-bar" role="navigation">		<div class="container-fluid">			<div class="pull-left">				<div data-ng-transclude></div>			</div>			<div class="dropdown pull-right"				data-ng-show="worlds.length > 0"				data-ng-class="getClasses(MENU_ELEMENTS.WORLD_SWITCHER)">				<a href="" class="dropdown-toggle" data-ng-click="toggleOpenState(MENU_ELEMENTS.WORLD_SWITCHER)">					<span class="glyphicon glyphicon-th"></span>				</a>				<ul class="dropdown-menu">					<li data-ng-repeat="world in worlds">						<a data-ng-href="{{ world.link }}">{{ world.name }}</a>					</li>				</ul>			</div>		</div>	</nav>	<nav class="navbar navbar-default navbar-level-2" data-ng-class="{\'navbar-fixed-top\': scrollOverNavbarFirst}"		role="navigation">		<div class="container-fluid">			<ul class="nav navbar-nav">				<li class="menu-navbar" data-ng-class="getClasses(MENU_ELEMENTS.MENU_BAR_TOGGLE)">					<a href="" data-ng-click="toggleSidebar($event, \'left\')">						<span class="glyphicon glyphicon-align-justify"></span>					</a>				</li>				<li data-ng-class="getClasses(MENU_ELEMENTS.APP_TITLE)">					<a data-ng-if="links.APP_ROOT !== null" class="application-title"						data-ng-href="{{ links.APP_ROOT }}">{{ getLabel(MESSAGE_KEY_PREFIX + \'_app_title\') }}</a>					<span data-ng-if="links.APP_ROOT === null" class="application-title">						{{ getLabel(MESSAGE_KEY_PREFIX + \'_app_title\') }}					</span>				</li>			</ul>			<ul class="nav navbar-nav navbar-right">				<li class="dropdown" data-ng-class="getClasses(MENU_ELEMENTS.USER_MENU)">					<a href="" data-ng-click="toggleOpenState(MENU_ELEMENTS.USER_MENU)">						<span class="glyphicon glyphicon-user"></span>						<span class="navbar-label" data-ng-class="getClasses(MENU_ELEMENTS.USER_MENU, \'label\')">							{{ user.givenName }} {{ user.familyName }}						</span>						<span class="caret"></span>					</a>					<ul class="dropdown-menu dropdown-menu-right">						<li>							<a data-ng-href="{{ links.USER_PROFILE }}" data-ng-click="closeAllMenus()">								{{ getLabel(MESSAGE_KEY_PREFIX + \'_user_profile\') }}							</a>						</li>						<li>							<a data-ng-href="{{ links.USER_LOGOUT }}" data-ng-click="closeAllMenus()">								{{ getLabel(MESSAGE_KEY_PREFIX + \'_user_logout\') }}							</a>						</li>					</ul>				</li>				<li class="dropdown"					data-ng-show="energyManagers.length > 0"					data-ng-class="getClasses(MENU_ELEMENTS.ENERGY_MANAGER_MENU)">					<a href="" class="dropdown-toggle"						data-ng-click="toggleOpenState(MENU_ELEMENTS.ENERGY_MANAGER_MENU)">						<span class="glyphicon glyphicon-tasks" title="Energy-Manager"></span>						<span class="navbar-label"							data-ng-class="getClasses(MENU_ELEMENTS.ENERGY_MANAGER_MENU, \'label\')">							{{ getLabel(MESSAGE_KEY_PREFIX + \'_energy_manager\') }}						</span>						<span>({{ energyManagers.length }})</span>						<span class="caret"></span>					</a>					<ul class="dropdown-menu">						<li data-ng-repeat="							entry in energyManagers |							orderBy:order(TYPES.ENERGY_MANAGER):reverse(TYPES.ENERGY_MANAGER) |							limitTo:LIMITS.ENERGY_MANAGER">							<a data-ng-href="{{ entry.link }}" data-ng-click="closeAllMenus()">								{{ entry.name }}							</a>						</li>						<li data-ng-if="energyManagers.length > LIMITS.ENERGY_MANAGER &&							links.ALL_ENERGY_MANAGERS !== null &&							labels.ALL_ENERGY_MANAGERS !== null">							<a data-ng-href="{{ links.ALL_ENERGY_MANAGERS }}" data-ng-click="closeAllMenus()">								{{ getLabel(MESSAGE_KEY_PREFIX + \'_all_energy_managers\') }}								({{ energyManagers.length }})							</a>						</li>					</ul>				</li>				<li class="dropdown"					data-ng-show="locales.length > 0"					data-ng-class="getClasses(MENU_ELEMENTS.LANGUAGE_MENU)">					<a href="" class="dropdown-toggle" data-ng-click="toggleOpenState(MENU_ELEMENTS.LANGUAGE_MENU)">						<span class="glyphicon glyphicon-flag"							title="{{ menus.languageMenu.activeEntry.nameShort }}"></span>						<span class="navbar-label" data-ng-class="getClasses(MENU_ELEMENTS.LANGUAGE_MENU, \'label\')">							{{ menus.languageMenu.activeEntry.nameShort }}						</span>						<span class="caret"></span>					</a>					<ul class="dropdown-menu">						<li data-ng-repeat="locale in locales"							data-ng-class="{ active: isActive(MENU_ELEMENTS.LANGUAGE_MENU, locale) }">							<a href="" data-ng-click="setLocale(locale)">{{ locale.name }}</a>						</li>					</ul>				</li>				<li class="dropdown" data-ng-class="getClasses(MENU_ELEMENTS.COMPACT_MENU)">					<a href="" data-ng-click="toggleOpenState(MENU_ELEMENTS.COMPACT_MENU)">						<span class="glyphicon glyphicon-option-vertical"></span>					</a>					<ul class="dropdown-menu dropdown-menu-right">						<li>							<a data-ng-href="{{ links.USER_PROFILE }}" data-ng-click="closeAllMenus()">								{{ getLabel(MESSAGE_KEY_PREFIX + \'_user_profile\') }}							</a>						</li>						<li>							<a data-ng-href="{{ links.USER_LOGOUT }}" data-ng-click="closeAllMenus()">								{{ getLabel(MESSAGE_KEY_PREFIX + \'_user_logout\') }}							</a>						</li>						<li class="divider" data-ng-if="energyManagers.length"></li>						<li data-ng-repeat="							entry in energyManagers |							orderBy:order(TYPES.ENERGY_MANAGER):reverse(TYPES.ENERGY_MANAGER) |							limitTo:LIMITS.ENERGY_MANAGER">							<a data-ng-href="{{ entry.link }}" data-ng-click="closeAllMenus()">								{{ entry.name }}							</a>						</li>						<li data-ng-if="energyManagers.length > LIMITS.ENERGY_MANAGER">							<a data-ng-href="{{ links.ALL_ENERGY_MANAGERS }}" data-ng-click="closeAllMenus()">								{{ getLabel(MESSAGE_KEY_PREFIX + \'_all_energy_managers\') }}								({{ energyManagers.length }})							</a>						</li>						<li class="divider" data-ng-if="locales"></li>						<li data-ng-repeat="entry in locales"							data-ng-class="{ active: isActive(MENU_ELEMENTS.LANGUAGE_MENU, entry) }">							<a href="" data-ng-click="setLocale(entry)">{{ entry.name }}</a>						</li>					</ul>				</li>				<li data-ng-class="getClasses(MENU_ELEMENTS.NOTIFICATION_BAR_TOGGLE)">					<a href="" id="toggleSidebarButton" data-ng-click="toggleSidebar($event, \'right\')">						<span class="glyphicon glyphicon-bell"							title="{{ getLabel(MESSAGE_KEY_PREFIX + \'_notifications\') }}"></span>						<span data-ng-show="notifications.length > 0" class="badge">{{notifications.length}}</span>					</a>				</li>			</ul>		</div>	</nav>	<div class="nav-backdrop"></div></div>')}),angular.module("keta.directives.ExtendedTable",["ngSanitize","keta.filters.OrderObjectBy","keta.filters.Slice","keta.filters.Unit","keta.utils.Common"]).constant("ExtendedTableConstants",{COMPONENT:{TABLE:"table",FILTER:"filter",SELECTOR:"selector",PAGER:"pager"},OPERATIONS_MODE:{DATA:"data",VIEW:"view"},PAGER:{TOTAL:"total",LIMIT:"limit",OFFSET:"offset"},ACTION_LIST_TYPE:{LINK:"link",ACTION:"action"}}).constant("ExtendedTableMessageKeys",{en:{"__keta.directives.ExtendedTable_search":"Search","__keta.directives.ExtendedTable_add_column":"Add column","__keta.directives.ExtendedTable_remove_column":"Remove column","__keta.directives.ExtendedTable_sort":"Sort","__keta.directives.ExtendedTable_no_entries":"No entries","__keta.directives.ExtendedTable_of":"of"},de:{"__keta.directives.ExtendedTable_search":"Suche","__keta.directives.ExtendedTable_add_column":"Spalte hinzufügen","__keta.directives.ExtendedTable_remove_column":"Spalte entfernen","__keta.directives.ExtendedTable_sort":"Sortieren","__keta.directives.ExtendedTable_no_entries":"Keine Einträge","__keta.directives.ExtendedTable_of":"von"}}).directive("extendedTable",function($compile,$filter,ExtendedTableConstants,ExtendedTableMessageKeys,CommonUtils){return{restrict:"EA",replace:!0,scope:{rows:"=",currentLocale:"=?",labels:"=?",disabledComponents:"=?",switchableColumns:"=?",groupByProperty:"=?",orderByProperty:"=?",visibleColumns:"=?",headerLabelCallback:"=?",operationsMode:"=?",rowSortEnabled:"=?",rowSortCriteria:"=?",rowSortOrderAscending:"=?",actionList:"=?",cellRenderer:"=?",columnClassCallback:"=?",tableClassCallback:"=?",pager:"=?",search:"=?",searchResults:"=?"},templateUrl:"/components/directives/extended-table.html",link:function(scope){scope.rows=angular.isDefined(scope.rows)&&angular.isArray(scope.rows)?scope.rows:[],scope.currentLocale=scope.currentLocale||"en",scope.MESSAGE_KEY_PREFIX="__keta.directives.ExtendedTable",scope.labels=angular.extend(ExtendedTableMessageKeys,scope.labels),scope.getLabel=function(key){return CommonUtils.getLabelByLocale(key,scope.labels,scope.currentLocale)},scope.headers=angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?scope.rows[0]:{},scope.disabledComponents=scope.disabledComponents||[scope.COMPONENTS_FILTER,scope.COMPONENTS_SELECTOR,scope.COMPONENTS_PAGER],scope.switchableColumns=scope.switchableColumns||[],scope.resetSelectedColumn(),scope.groupByProperty=scope.groupByProperty||null,scope.orderByProperty=scope.orderByProperty||"",scope.visibleColumns=scope.visibleColumns||(angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?Object.keys(scope.rows[0]):[]),scope.headerLabelCallback=scope.headerLabelCallback||function(column){return column},scope.operationsMode=scope.operationsMode||scope.OPERATIONS_MODE_VIEW,scope.rowSortEnabled=angular.isDefined(scope.rowSortEnabled)?scope.rowSortEnabled:!1,scope.rowSortCriteria=scope.rowSortCriteria||(angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?Object.keys(scope.rows[0])[0]:null),scope.rowSortOrderAscending=angular.isDefined(scope.rowSortOrderAscending)?scope.rowSortOrderAscending:!0,scope.actionList=scope.actionList||[],scope.cellRenderer=scope.cellRenderer||function(row,column){return angular.isDefined(row[column])?row[column]:null},scope.columnClassCallback=scope.columnClassCallback||function(){return""},scope.tableClassCallback=scope.tableClassCallback||function(){return["table-striped"]};var defaultPager={};defaultPager[scope.PAGER_TOTAL]=scope.rows.length,defaultPager[scope.PAGER_LIMIT]=scope.rows.length,defaultPager[scope.PAGER_OFFSET]=0,scope.pager=angular.extend(defaultPager,scope.pager),scope.resetPager(),scope.search=scope.search||null,scope.searchResults=scope.searchResults||scope.rows},controller:function($scope){$scope.COMPONENTS_FILTER=ExtendedTableConstants.COMPONENT.FILTER,$scope.COMPONENTS_SELECTOR=ExtendedTableConstants.COMPONENT.SELECTOR,$scope.COMPONENTS_TABLE=ExtendedTableConstants.COMPONENT.TABLE,$scope.COMPONENTS_PAGER=ExtendedTableConstants.COMPONENT.PAGER,$scope.OPERATIONS_MODE_DATA=ExtendedTableConstants.OPERATIONS_MODE.DATA,$scope.OPERATIONS_MODE_VIEW=ExtendedTableConstants.OPERATIONS_MODE.VIEW,$scope.PAGER_TOTAL=ExtendedTableConstants.PAGER.TOTAL,$scope.PAGER_LIMIT=ExtendedTableConstants.PAGER.LIMIT,$scope.PAGER_OFFSET=ExtendedTableConstants.PAGER.OFFSET,$scope.pages=[],$scope.currentPage=0,$scope.selectedColumn=null;var update=function(){angular.isDefined($scope.rows)&&angular.isDefined($scope.rows[0])?(angular.equals($scope.headers,{})&&($scope.headers=$scope.rows[0]),angular.equals($scope.visibleColumns,[])&&($scope.visibleColumns=Object.keys($scope.rows[0])),null===$scope.rowSortCriteria&&($scope.rowSortCriteria=Object.keys($scope.rows[0])[0])):($scope.headers={},$scope.visibleColumns=[],$scope.rowSortCriteria=null)},inArray=function(array,element){var found=!1;return angular.forEach(array,function(item){item===element&&(found=!0)}),found};$scope.resetPager=function(){if($scope.operationsMode===$scope.OPERATIONS_MODE_VIEW){var rowsLength=null!==$scope.search?$filter("filter")($scope.rows,$scope.search).length:$scope.rows.length;$scope.pager[$scope.PAGER_TOTAL]=rowsLength,0===$scope.pager[$scope.PAGER_LIMIT]&&($scope.pager[$scope.PAGER_LIMIT]=rowsLength),$scope.pager[$scope.PAGER_OFFSET]>rowsLength-1&&($scope.pager[$scope.PAGER_OFFSET]=0)}if(angular.isNumber($scope.pager[$scope.PAGER_TOTAL])&&angular.isNumber($scope.pager[$scope.PAGER_LIMIT])){$scope.pages=[];for(var numOfPages=Math.ceil($scope.pager[$scope.PAGER_TOTAL]/$scope.pager[$scope.PAGER_LIMIT]),i=0;numOfPages>i;i++)$scope.pages.push(i+1)}angular.isNumber($scope.pager[$scope.PAGER_LIMIT])&&angular.isNumber($scope.pager[$scope.PAGER_OFFSET])&&($scope.currentPage=Math.floor($scope.pager[$scope.PAGER_OFFSET]/$scope.pager[$scope.PAGER_LIMIT])+1)},$scope.resetSelectedColumn=function(){var possibleColumns=$filter("filter")($scope.switchableColumns,function(column){return!inArray($scope.visibleColumns,column.id)}),stillPossible=!1;angular.forEach(possibleColumns,function(column){column.id===$scope.selectedColumn&&(stillPossible=!0)}),stillPossible||(possibleColumns=$filter("orderBy")(possibleColumns,$scope.orderByProperty),$scope.selectedColumn=angular.isDefined(possibleColumns[0])?possibleColumns[0].id:null)},$scope.$watch("rows",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&(update(),$scope.resetPager())},!0),$scope.$watch("pager",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&$scope.resetPager()},!0),$scope.$watch("search",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&($scope.resetPager(),$scope.searchResults=$filter("filter")($scope.rows,$scope.searchIn))}),$scope.$watch("switchableColumns",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&$scope.resetSelectedColumn()},!0),$scope.getTableClasses=function(){var configuredClasses=$scope.tableClassCallback();return configuredClasses.push("table"),configuredClasses.push("form-group"),configuredClasses.join(" ")},$scope.isDisabled=function(key){return inArray($scope.disabledComponents,key)},$scope.isSwitchable=function(key){var switchable=!1;return angular.forEach($scope.switchableColumns,function(column){column.id===key&&(switchable=!0)}),switchable},$scope.isSortCriteria=function(key){return null!==$scope.rowSortCriteria?key===$scope.rowSortCriteria:!1},$scope.sortBy=function(column){$scope.rowSortEnabled&&null!==$scope.headerLabelCallback(column)&&""!==$scope.headerLabelCallback(column)&&($scope.rowSortCriteria===column?$scope.rowSortOrderAscending=!$scope.rowSortOrderAscending:$scope.rowSortCriteria=column)},$scope.searchIn=function(row){if(!angular.isDefined($scope.search)||null===$scope.search||""===$scope.search)return!0;var match=!1;return angular.forEach($scope.visibleColumns,function(column){if(angular.isDefined(row[column])&&null!==row[column])if(angular.isObject(row[column])&&!angular.isArray(row[column])){var deepMatch=!1;angular.forEach(row[column],function(prop){-1!==String(prop).toLowerCase().indexOf($scope.search.toLowerCase())&&(deepMatch=!0)}),deepMatch===!0&&(match=!0)}else-1!==String(row[column]).toLowerCase().indexOf($scope.search.toLowerCase())&&(match=!0)}),match},$scope.filterColumns=function(column){return!inArray($scope.visibleColumns,column.id)},$scope.addColumn=function(column){$scope.visibleColumns.push(column),$scope.resetSelectedColumn()},$scope.removeColumn=function(column){var columns=[];angular.forEach($scope.visibleColumns,function(col){col!==column&&columns.push(col)}),$scope.visibleColumns=columns,$scope.resetSelectedColumn()},$scope.goToPage=function(page){page>0&&page<=$scope.pages.length&&($scope.pager[$scope.PAGER_OFFSET]=$scope.pager[$scope.PAGER_LIMIT]*(page-1),$scope.resetPager())};var resetPagerInputIfNecessary=function(currentPage){var parsingRadix=10,pageAsNumber=parseInt(currentPage,parsingRadix),newPage=pageAsNumber;!angular.isNumber(pageAsNumber)||isNaN(pageAsNumber)||0>=pageAsNumber?newPage=1:pageAsNumber>$scope.pages.length&&(newPage=$scope.pages.length),$scope.goToPage(newPage)};$scope.checkPagerInput=function(currentPage,$event){switch($event.type){case"keypress":13===$event.keyCode&&resetPagerInputIfNecessary(currentPage);break;case"blur":resetPagerInputIfNecessary(currentPage)}}}}}),angular.module("keta.directives.ExtendedTable").run(function($templateCache){$templateCache.put("/components/directives/extended-table.html",'<div data-ng-class="{	\'keta-extended-table\': true}">	<div class="row" data-ng-show="!isDisabled(COMPONENTS_FILTER) || !isDisabled(COMPONENTS_SELECTOR)">		<div class="col-xs-12 col-sm-6">			<!-- FILTER -->			<div data-ng-show="!isDisabled(COMPONENTS_FILTER)">				<div class="form-group form-inline">					<div class="input-group col-xs-12 col-sm-8 col-md-6">						<input type="text" class="form-control"							placeholder="{{ getLabel(MESSAGE_KEY_PREFIX + \'_search\') }}" data-ng-model="search">						<div class="input-group-addon"><span class="glyphicon glyphicon-search"></span></div>					</div>				</div>			</div>		</div>		<div class="col-xs-12 col-sm-6 col-md-6 col-lg-5 pull-right">			<!-- SELECTOR -->			<div data-ng-show="!isDisabled(COMPONENTS_SELECTOR)">				<div class="form-group pull-right" data-ng-show="selectedColumn !== null">					<div class="form-group">						<div class="button-form">							<label for="columnSelector">{{ getLabel(MESSAGE_KEY_PREFIX + \'_add_column\') }}</label>							<div class="input-group">								<select id="columnSelector"									class="add-select form-control"									data-ng-if="groupByProperty !== null"									data-ng-model="$parent.selectedColumn"									data-ng-options="										column.id as headerLabelCallback(column.id)											group by {{groupByProperty}} for column in switchableColumns |										filter:filterColumns |										orderBy:orderByProperty">								</select>								<select id="columnSelector"									class="add-select form-control"									data-ng-if="groupByProperty === null"									data-ng-model="$parent.selectedColumn"									data-ng-options="										column.id as headerLabelCallback(column.id) for column in switchableColumns |										filter:filterColumns |										orderBy:orderByProperty">								</select>								<div class="stepper-buttons input-group-btn">									<button type="button" class="btn btn-primary"										data-ng-click="addColumn(selectedColumn)">										<i class="glyphicon glyphicon-plus"></i>									</button>								</div>							</div>						</div>					</div>				</div>			</div>		</div>	</div>	<!-- TABLE -->	<div class="row" data-ng-show="!isDisabled(COMPONENTS_TABLE)">		<div class="col-xs-12">			<div class="table-responsive table-data">				<table data-ng-class="getTableClasses()">					<thead>						<tr>							<th class="{{columnClassCallback(headers, column, true)}} sortable"								data-ng-repeat="column in headers | orderObjectBy:visibleColumns:true"								data-ng-if="rowSortEnabled"								data-ng-class="{sort: isSortCriteria(column)}">								<a class="header" title="{{ getLabel(MESSAGE_KEY_PREFIX + \'_sort\') }}"								   data-ng-click="sortBy(column)">{{headerLabelCallback(column)}}</a>								<a class="sort" title="{{ getLabel(MESSAGE_KEY_PREFIX + \'_sort\') }}"								   data-ng-if="isSortCriteria(column) && rowSortOrderAscending"								   data-ng-click="sortBy(column)"><span									class="glyphicon glyphicon-sort-by-alphabet"></span></a>								<a class="sort" title="{{ getLabel(MESSAGE_KEY_PREFIX + \'_sort\') }}"								   data-ng-if="isSortCriteria(column) && !rowSortOrderAscending"								   data-ng-click="sortBy(column)"><span									class="glyphicon glyphicon-sort-by-alphabet-alt"></span></a>								<a class="unsort" title="{{ getLabel(MESSAGE_KEY_PREFIX + \'_sort\') }}"									data-ng-if="!isSortCriteria(column) && headerLabelCallback(column) !== null"									data-ng-click="sortBy(column)"><span									class="glyphicon glyphicon-sort"></span></a>								<a class="operation" title="{{ getLabel(MESSAGE_KEY_PREFIX + \'_remove_column\') }}"								   data-ng-if="isSwitchable(column)"								   data-ng-click="removeColumn(column)"><span									class="glyphicon glyphicon-minus-sign"></span></a>							</th>							<th class="{{columnClassCallback(headers, column, true)}}"								data-ng-repeat="column in headers | orderObjectBy:visibleColumns:true"								data-ng-if="!rowSortEnabled">								{{headerLabelCallback(column)}}								<a class="operation" data-ng-if="isSwitchable(column)"									data-ng-click="removeColumn(column)">									<span class="glyphicon glyphicon-minus-sign"></span>								</a>							</th>							<th data-ng-if="actionList.length">								{{headerLabelCallback(\'actions\')}}							</th>						</tr>					</thead>					<tbody>						<!-- operationsMode: data -->						<tr data-ng-if="operationsMode === OPERATIONS_MODE_DATA"							data-ng-repeat="row in rows">							<td data-ng-repeat="column in row | orderObjectBy:visibleColumns:true"								class="{{columnClassCallback(row, column, false)}}">								<span data-ng-bind-html="cellRenderer(row, column)"></span>							</td>							<td data-ng-if="row && actionList.length">								<div class="btn-group" role="group">									<span data-ng-repeat="item in actionList">										<a class="btn-link"											data-ng-href="{{item.getLink(row)}}"											data-ng-if="!item.type || item.type === \'link\'"											title="{{item.label}}">											<span class="{{item.icon}}" aria-hidden="true"></span>										</a>										<a class="btn-link"											href=""											data-ng-click="item.runAction(row)"											data-ng-if="item.type === \'action\'"											title="{{item.label}}">											<span class="{{item.icon}}" aria-hidden="true"></span>										</a>									</span>								</div>							</td>						</tr>						<!-- operationsMode: view -->						<tr data-ng-if="operationsMode === OPERATIONS_MODE_VIEW"							data-ng-repeat="								row in rows |								filter:searchIn |								orderBy:rowSortCriteria:!rowSortOrderAscending |								slice:pager[PAGER_OFFSET]:pager[PAGER_LIMIT]">							<td data-ng-repeat="column in row | orderObjectBy:visibleColumns:true"								class="{{columnClassCallback(row, column, false)}}">								<span data-ng-bind-html="cellRenderer(row, column)"></span>							</td>							<td data-ng-if="row && actionList.length">								<div class="btn-group" role="group">									<span data-ng-repeat="item in actionList">										<a class="btn-link"												data-ng-href="{{item.getLink(row)}}"												data-ng-if="!item.type || item.type === \'link\'"												title="{{item.label}}">											<span class="{{item.icon}}" aria-hidden="true"></span>										</a>										<a class="btn-link"												href=""												data-ng-click="item.runAction(row)"												data-ng-if="item.type === \'action\'"												title="{{item.label}}">											<span class="{{item.icon}}" aria-hidden="true"></span>										</a>									</span>								</div>							</td>						</tr>						<tr data-ng-if="							operationsMode === OPERATIONS_MODE_VIEW &&							(rows |								filter:searchIn |								orderBy:rowSortCriteria:!rowSortOrderAscending |								slice:pager[PAGER_OFFSET]:pager[PAGER_LIMIT]).length === 0">							<td colspan="{{(rows[0] | orderObjectBy:visibleColumns:true).length + 1}}">								{{ getLabel(MESSAGE_KEY_PREFIX + \'_no_entries\') }}							</td>						</tr>					</tbody>				</table>			</div>		</div>	</div>	<!-- PAGER -->	<div class="row" data-ng-show="!isDisabled(COMPONENTS_PAGER) && pager !== null && pages.length > 1">		<div class="col-xs-12 col-sm-6">			<div class="pager max-width">				<div class="input-group">					<div class="pager-buttons input-group-btn">						<button type="button" class="btn btn-default" data-ng-click="goToPage(currentPage - 1)">							<i class="glyphicon glyphicon-chevron-left"></i>						</button>					</div>					<input type="text" class="form-control pager-input"						data-ng-model="currentPage"						data-ng-keypress="checkPagerInput(currentPage, $event)"						data-ng-blur="checkPagerInput(currentPage, $event)">					<span class="input-group-addon">						{{ getLabel(MESSAGE_KEY_PREFIX + \'_of\') }} {{pages.length}}					</span>					<div class="pager-buttons input-group-btn">						<button type="button" class="btn btn-default" data-ng-click="goToPage(currentPage + 1)">							<i class="glyphicon glyphicon-chevron-right"></i>						</button>					</div>				</div>			</div>		</div>	</div></div>');
}),angular.module("keta.directives.MainMenu",[]).directive("mainMenu",function($location,$rootScope){return{restrict:"EA",replace:!0,scope:{configuration:"=",titleCallback:"=?"},templateUrl:"/components/directives/main-menu.html",link:function(scope){scope.titleCallback=scope.titleCallback||function(){return""};var checkPaths=function(currentMenuLevelParts,locationLevelParts,activeFlag){for(var i=1;i<currentMenuLevelParts.length;i++)currentMenuLevelParts[i]!==locationLevelParts[i]&&(activeFlag=!1);return activeFlag};scope.isActive=function(menuEntry){var currentMenuLevelParts=menuEntry.link.split("/"),locationLevelParts=$location.path().split("/"),isActive=!0;return angular.isArray(menuEntry.items)&&menuEntry.items.length>0?!1:isActive=checkPaths(currentMenuLevelParts,locationLevelParts,isActive)},scope.isActiveParent=function(menuEntry){var currentMenuLevelParts=menuEntry.link.split("/"),locationLevelParts=$location.path().split("/"),isActiveParent=!1;return angular.isArray(menuEntry.items)&&menuEntry.items.length>0&&(isActiveParent=!0,isActiveParent=checkPaths(currentMenuLevelParts,locationLevelParts,isActiveParent)),isActiveParent},scope.checkExpand=function(menuEntry,$event){$location.path()===menuEntry.link&&angular.isDefined(scope.configuration.toggleBroadcast)&&($event.stopPropagation(),$rootScope.$broadcast(scope.configuration.toggleBroadcast)),angular.isArray(menuEntry.items)&&menuEntry.items.length>0&&($event.preventDefault(),angular.isUndefined(menuEntry.expanded)||menuEntry.expanded===!1?menuEntry.expanded=!0:menuEntry.expanded=!menuEntry.expanded)}}}}),angular.module("keta.directives.MainMenu").run(function($templateCache){$templateCache.put("/components/directives/main-menu.html",'<div>	<div data-ng-show="titleCallback()" class="sidebar-title">		<span>{{ titleCallback() }}</span>	</div>	<ul class="nav nav-pills nav-stacked keta-main-menu">		<li data-ng-repeat="entry in configuration.items"			data-ng-class="{				\'active\': isActive(entry),				\'active-parent\': isActiveParent(entry)			}">			<a data-ng-href="{{ entry.link }}" data-ng-click="checkExpand(entry, $event)"			   title="{{ entry.name }}">				<span class="{{ entry.icon }}"></span>				<span class="list-item">{{ entry.name }}</span>				<span class="expander glyphicon"					data-ng-if="entry.items"					data-ng-class="{ \'glyphicon-minus\': entry.expanded, \'glyphicon-plus\': !entry.expanded }">				</span>			</a>			<ul class="nav nav-pills nav-stacked expanded nav-sub-level" data-ng-show="entry.expanded">				<li data-ng-repeat="entryLevel2 in entry.items"					data-ng-class="{						\'active\': isActive(entryLevel2),						\'active-parent\': isActiveParent(entryLevel2)					}">					<a data-ng-href="{{ entryLevel2.link }}" data-ng-click="checkExpand(entryLevel2, $event)">						<span data-ng-if="entryLevel2.icon" class="{{ entryLevel2.icon }}"></span>						<span>{{ entryLevel2.name }}</span>						<span class="expander glyphicon"							data-ng-if="entryLevel2.items"							data-ng-class="{ \'glyphicon-minus\': entryLevel2.expanded, \'glyphicon-plus\': !entryLevel2.expanded }">						</span>					</a>					<ul class="nav nav-pills nav-stacked expanded nav-sub-level" data-ng-show="entryLevel2.expanded">						<li data-ng-repeat="entryLevel3 in entryLevel2.items"							data-ng-class="{ \'active\': isActive(entryLevel3) }">							<a data-ng-href="{{ entryLevel3.link }}">								<span data-ng-if="entryLevel3.icon" class="{{ entryLevel3.icon }}"></span>								<span>{{ entryLevel3.name }}</span>							</a>						</li>					</ul>				</li>			</ul>		</li>	</ul></div>')}),angular.module("keta.directives.Sidebar",[]).constant("SidebarConstants",{POSITION:{LEFT:"left",RIGHT:"right"},CSS:{OFFCANVAS:"offcanvas",BRAND_BAR:"brand-bar"},OFFSET:{TOGGLE_AREA:5,TRANSCLUDE:15},EVENT:{TOGGLE_SIDEBAR_LEFT:"TOGGLE_SIDEBAR_LEFT",TOGGLE_SIDEBAR_RIGHT:"TOGGLE_SIDEBAR_RIGHT"}}).directive("sidebar",function($document,SidebarConstants){return{restrict:"EA",replace:!0,scope:{configuration:"="},templateUrl:"/components/directives/sidebar.html",transclude:!0,link:function(scope,element){scope.configuration.position=angular.isDefined(scope.configuration.position)?scope.configuration.position:SidebarConstants.POSITION.LEFT,scope.showToggleArea=angular.isDefined(scope.configuration.label),scope.toggleAreaTop=0,scope.transcludeTop=0;var bodyElem=angular.element(document).find("body");scope.toggleSideBar=function(){bodyElem.toggleClass(SidebarConstants.CSS.OFFCANVAS+"-"+scope.configuration.position)},scope.$on("$locationChangeStart",function(){bodyElem.removeClass(SidebarConstants.CSS.OFFCANVAS+"-"+scope.configuration.position)});var toggleBodyClass=function(position){scope.configuration.position===position&&bodyElem.toggleClass(SidebarConstants.CSS.OFFCANVAS+"-"+scope.configuration.position)};if(scope.$on(SidebarConstants.EVENT.TOGGLE_SIDEBAR_LEFT,function(){toggleBodyClass(SidebarConstants.POSITION.LEFT)}),scope.$on(SidebarConstants.EVENT.TOGGLE_SIDEBAR_RIGHT,function(){toggleBodyClass(SidebarConstants.POSITION.RIGHT)}),scope.showToggleArea){var brandBarElem=bodyElem[0].getElementsByClassName(SidebarConstants.CSS.BRAND_BAR),brandBarHeight=angular.isDefined(brandBarElem[0])?brandBarElem[0].clientHeight:0;scope.toggleAreaTop=brandBarHeight+SidebarConstants.OFFSET.TOGGLE_AREA,scope.transcludeTop=SidebarConstants.OFFSET.TRANSCLUDE}$document.bind("click",function(event){if(bodyElem.hasClass(SidebarConstants.CSS.OFFCANVAS+"-"+scope.configuration.position)){var sideBarHtml=element.html(),targetElementHtml=angular.element(event.target).html();if(-1!==sideBarHtml.indexOf(targetElementHtml)&&0!==targetElementHtml.length)return;scope.toggleSideBar()}})}}}),angular.module("keta.directives.Sidebar").run(function($templateCache){$templateCache.put("/components/directives/sidebar.html",'<div class="sidebar-offcanvas sidebar-{{configuration.position}} keta-sidebar">	<div class="sidebar-inner">				<!-- extended navigation -->		<ul class="nav nav-pills nav-stacked nav-extended nav-extended-toggle"			data-ng-if="showToggleArea" data-ng-style="{marginTop: toggleAreaTop + \'px\'}">			<li>				<a href="" data-ng-click="toggleSideBar()">					<span class="glyphicon glyphicon-align-justify"></span>					<span>{{ configuration.label }}</span>				</a>			</li>		</ul>				<!-- compact navigation -->		<ul class="nav nav-pills nav-stacked nav-compact nav-compact-toggle"			data-ng-if="showToggleArea">			<li>				<a href="" data-ng-click="toggleSideBar()">					<span class="glyphicon glyphicon-align-justify"></span>				</a>			</li>		</ul>				<!--  transcluded content -->		<div data-ng-transclude class="sidebar-transclude" data-ng-style="{marginTop: transcludeTop + \'px\'}"></div>			</div></div>')}),angular.module("keta.filters.OrderObjectBy",[]).filter("orderObjectBy",function(){return function(input,order,returnKey){if(!angular.isObject(input))return input;returnKey=returnKey||!1;var fields=[];angular.isDefined(order)&&null!==order?fields=order:angular.forEach(input,function(value,key){0!==key.indexOf("$")&&fields.push(key)});var sorted=[];return angular.forEach(fields,function(field){angular.isDefined(input[field])&&sorted.push(returnKey?field:input[field])}),sorted}}),angular.module("keta.filters.Slice",[]).filter("slice",function(){return function(arr,offset,limit){return angular.isDefined(arr)&&angular.isArray(arr)||(arr=[]),angular.isDefined(offset)&&angular.isNumber(offset)||(offset=0),angular.isDefined(limit)&&angular.isNumber(limit)||(limit=arr.length),arr.slice(offset,offset+limit)}}),angular.module("keta.filters.Unit",["keta.services.Tag"]).filter("unit",function($filter,TagConstants){return function(input,configuration){if(!angular.isNumber(input))return input;var precision=0,precisionRanges=[],unit="",isBytes=!1,separate=!1,separated={numberFormatted:null,numberRaw:null,unit:null};angular.isDefined(configuration)&&(precision=angular.isNumber(configuration.precision)?configuration.precision:precision,precisionRanges=angular.isArray(configuration.precisionRanges)?configuration.precisionRanges:precisionRanges,unit=angular.isDefined(configuration.unit)?configuration.unit:unit,isBytes=angular.isDefined(configuration.isBytes)?configuration.isBytes:isBytes,separate=angular.isDefined(configuration.separate)?configuration.separate:separate),angular.forEach(precisionRanges,function(range){var matching=!0;angular.isDefined(range.min)&&input<range.min&&(matching=!1),angular.isDefined(range.max)&&input>=range.max&&(matching=!1),angular.isDefined(range.min)||angular.isDefined(range.max)||(matching=!1),matching&&angular.isNumber(range.precision)&&(precision=range.precision)}),0===input&&(precision=0);var sizes=isBytes?["Bytes","KB","MB","GB","TB"]:["","k","M","G","T"];if(unit===TagConstants.UNIT.EURO||unit===TagConstants.UNIT.KILOMETER||unit===TagConstants.UNIT.DOLLAR||unit===TagConstants.UNIT.POUND)return $filter("number")(input,precision)+" "+unit;var multiplicator=0>input?-1:1,oneKiloByte=1024,oneKilo=1e3,parseBase=10;if(input*=multiplicator,input>=1){var i=parseInt(Math.floor(Math.log(input)/Math.log(isBytes?oneKiloByte:oneKilo)),parseBase),siInput=input/Math.pow(isBytes?oneKiloByte:oneKilo,i)*multiplicator,siInputFixed=Number(siInput.toFixed(precision));siInputFixed>=oneKilo&&(i++,siInputFixed/=oneKilo),separated.numberFormatted=$filter("number")(siInputFixed),separated.numberRaw=siInputFixed,separated.unit=sizes[i]+unit,input=separated.numberFormatted+(""!==sizes[i]?" "+sizes[i]:"")}else separated.numberFormatted=$filter("number")(input,precision),separated.numberRaw=input,separated.unit=unit,input=separated.numberFormatted;return isBytes||""===unit||(input+=-1===input.indexOf(" ")?" "+unit:unit),separate?separated:input}}),angular.module("keta.services.AccessToken",["keta.services.AppContext"]).factory("AccessToken",function($http,AppContext){var accessToken=AppContext.get("oauth.accessToken"),Base64={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)enc1=this.keyStr.indexOf(input.charAt(i++)),enc2=this.keyStr.indexOf(input.charAt(i++)),enc3=this.keyStr.indexOf(input.charAt(i++)),enc4=this.keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!==enc3&&(output+=String.fromCharCode(chr2)),64!==enc4&&(output+=String.fromCharCode(chr3));return Base64.utf8Decode(output)},encode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=Base64.utf8Encode(input);i<input.length;)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this.keyStr.charAt(enc1)+this.keyStr.charAt(enc2)+this.keyStr.charAt(enc3)+this.keyStr.charAt(enc4);return output},utf8Decode:function(utfText){for(var string="",i=0,c=0,c2=0,c3=0;i<utfText.length;)c=utfText.charCodeAt(i),128>c?(string+=String.fromCharCode(c),i++):c>191&&224>c?(c2=utfText.charCodeAt(i+1),string+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=utfText.charCodeAt(i+1),c3=utfText.charCodeAt(i+2),string+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return string},utf8Encode:function(string){string=string.replace(/\r\n/g,"\n");for(var utfText="",n=0;n<string.length;n++){var c=string.charCodeAt(n);128>c?utfText+=String.fromCharCode(c):c>127&&2048>c?(utfText+=String.fromCharCode(c>>6|192),utfText+=String.fromCharCode(63&c|128)):(utfText+=String.fromCharCode(c>>12|224),utfText+=String.fromCharCode(c>>6&63|128),utfText+=String.fromCharCode(63&c|128))}return utfText}},api={get:function(){return accessToken},set:function(token){angular.isDefined(token)&&angular.isString(token)&&(accessToken=token)},decode:function(token){var props={};try{var decoded=Base64.decode(token);-1!==decoded.indexOf("}.")&&(decoded=decoded.substr(0,decoded.indexOf("}.")+1)),props=JSON.parse(decoded)}catch(e){return null}return props},encode:function(props){return Base64.encode(JSON.stringify(props))},refresh:function(){var refreshUrl=AppContext.get("oauth.refreshTokenPath")||"/refreshAccessToken";return $http({method:"GET",url:refreshUrl})}};return api}),angular.module("keta.services.AppContext",[]).provider("AppContext",function(){var appContext=angular.isDefined(window.appContext)?window.appContext:{};this.get=function(key){var obj=appContext;key=key.split(".");for(var i=0,l=key.length;l>i;i++){if(!angular.isDefined(obj[key[i]]))return null;obj=obj[key[i]]}return obj},this.$get=function(){var api={get:this.get};return api}}),angular.module("keta.services.ApplicationSet",["keta.services.Application"]).provider("ApplicationSet",function(){var DEFAULT_OFFSET=0,DEFAULT_LIMIT=50;this.$get=function($q,$rootScope,$log,Application,EventBusDispatcher,EventBusManager){var ApplicationSetInstance=function(givenEventBus){var that=this,eventBus=givenEventBus,params={};that.filter=function(filter){return params.filter=filter,that},that.project=function(projection){return params.projection=projection,that},that.sort=function(sorting){return params.sorting=sorting,that},that.paginate=function(pagination){return angular.isDefined(pagination)?(params.offset=angular.isDefined(pagination.offset)?pagination.offset:DEFAULT_OFFSET,params.limit=angular.isDefined(pagination.limit)?pagination.limit:DEFAULT_LIMIT):(params.offset=DEFAULT_OFFSET,params.limit=DEFAULT_LIMIT),that},that.query=function(){var deferred=$q.defer();return EventBusDispatcher.send(eventBus,"appservice",{action:"getAppsInfo",params:params},function(reply){reply?(reply.params=params,reply.code===EventBusDispatcher.RESPONSE_CODE_OK?(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)&&angular.forEach(reply.result.items,function(item,index){reply.result.items[index]=Application.create(eventBus,item)}),EventBusManager.inDebugMode()&&$log.request(["appservice",{action:"getAppsInfo",params:params},reply],$log.ADVANCED_FORMATTER),deferred.resolve(reply),$rootScope.$digest()):deferred.reject(reply)):deferred.reject("Something bad happened. Got no reply.")}),deferred.promise}},api={create:function(eventBus){return new ApplicationSetInstance(eventBus)},indexOf:function(set,application){var index=-1;return angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.forEach(set.result.items,function(item,key){item.appId===application.appId&&(index=key)}),index},length:function(set){var length=angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.isArray(set.result.items)?set.result.items.length:0;return length},get:function(set,index){var application=angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.isDefined(set.result.items[index])?set.result.items[index]:null;return application},getAll:function(set){var applications=angular.isDefined(set.result)&&angular.isDefined(set.result.items)?set.result.items:[];return applications}};return api}}),angular.module("keta.services.Application",["keta.services.EventBusDispatcher","keta.services.EventBusManager","keta.services.Logger"]).provider("Application",function(){this.$get=function(){var ApplicationInstance=function(givenEventBus,properties){var that=this;angular.forEach(properties,function(value,key){that[key]=value,angular.isDefined(that.$pristine)||(that.$pristine={}),that.$pristine[key]=angular.copy(value)})},api={create:function(eventBus,properties){return new ApplicationInstance(eventBus,properties)}};return api}}),angular.module("keta.services.DeviceEvent",[]).provider("DeviceEvent",function(){this.$get=function(){var DeviceEventInstance=function(givenType,givenDevice){var that=this,type=givenType;that.getType=function(){return type};var device=givenDevice;that.getDevice=function(){return device}},api={CREATED:"CREATED",UPDATED:"UPDATED",DELETED:"DELETED",create:function(type,device){return new DeviceEventInstance(type,device)}};return api}}),angular.module("keta.services.DeviceSet",["keta.services.Device","keta.services.DeviceEvent"]).provider("DeviceSet",function(){var DEFAULT_OFFSET=0,DEFAULT_LIMIT=50;this.$get=function($q,$rootScope,$log,Device,DeviceEvent,EventBusDispatcher,EventBusManager){var api,DeviceSetInstance=function(givenEventBus){var that=this,eventBus=givenEventBus,params={},registerListener=!1,set={};that.filter=function(filter){return params.filter=filter,that},that.project=function(projection){return params.projection=projection,that},that.sort=function(sorting){return params.sorting=sorting,that},that.paginate=function(pagination){return angular.isDefined(pagination)?(params.offset=angular.isDefined(pagination.offset)?pagination.offset:DEFAULT_OFFSET,params.limit=angular.isDefined(pagination.limit)?pagination.limit:DEFAULT_LIMIT):(params.offset=DEFAULT_OFFSET,params.limit=DEFAULT_LIMIT),that},that.live=function(){return registerListener=!0,that},that.query=function(){var deferred=$q.defer();if(registerListener){var liveHandlerUUID="CLIENT_"+EventBusDispatcher.generateUUID();EventBusDispatcher.registerHandler(eventBus,liveHandlerUUID,function(event){if(!angular.isDefined(event.value.guid)&&angular.isDefined(event.value.tagValues)){var tagValueKeys=Object.keys(event.value.tagValues);event.value.guid=event.value.tagValues[tagValueKeys[0]].guid}api.sync(set,DeviceEvent.create(event.type,event.value),eventBus),EventBusManager.inDebugMode()&&$log.event([event],$log.ADVANCED_FORMATTER)}),EventBusDispatcher.send(eventBus,"deviceservice",{action:"registerDeviceSetListener",body:{filter:params.filter,projection:params.projection,replyAddress:liveHandlerUUID}},function(reply){EventBusManager.inDebugMode()&&$log.request(["deviceservice",{action:"registerDeviceSetListener",body:{filter:params.filter,projection:params.projection,replyAddress:liveHandlerUUID}},reply],$log.ADVANCED_FORMATTER)})}return EventBusDispatcher.send(eventBus,"deviceservice",{action:"getDevices",params:params},function(reply){reply?(reply.params=params,reply.code===EventBusDispatcher.RESPONSE_CODE_OK?(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)?(angular.forEach(reply.result.items,function(item,index){reply.result.items[index]=Device.create(eventBus,item)}),set=reply):set={},EventBusManager.inDebugMode()&&$log.request(["deviceservice",{action:"getDevices",params:params},reply],$log.ADVANCED_FORMATTER),deferred.resolve(reply),$rootScope.$digest()):deferred.reject(reply)):deferred.reject("Something bad happened. Got no reply.")}),deferred.promise}};return api={create:function(eventBus){return new DeviceSetInstance(eventBus)},indexOf:function(set,device){var index=-1;return angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.forEach(set.result.items,function(item,key){item.guid===device.guid&&(index=key)}),index},length:function(set){var length=angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.isArray(set.result.items)?set.result.items.length:0;return length},get:function(set,index){var device=angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.isDefined(set.result.items[index])?set.result.items[index]:null;return device},getAll:function(set){var devices=angular.isDefined(set.result)&&angular.isDefined(set.result.items)?set.result.items:[];return devices},sync:function(set,event,eventBus){var modified=!1,device=Device.create(eventBus,event.getDevice());if(event.getType()===DeviceEvent.CREATED)set.result.items.push(device),modified=!0;else if(event.getType()===DeviceEvent.DELETED)set.result.items.splice(api.indexOf(set,device),1),modified=!0;else if(event.getType()===DeviceEvent.UPDATED){var index=api.indexOf(set,device);-1!==index&&(angular.extend(api.get(set,index),device),modified=!0)}modified&&!$rootScope.$$phase&&$rootScope.$apply()}}}}),angular.module("keta.services.Device",["keta.services.EventBusDispatcher","keta.services.EventBusManager","keta.services.Logger"]).constant("DeviceConstants",{STATE:{OK:"OK",ERROR:"ERROR",FATAL:"FATAL"},CLASS:{ENERGY_MANAGER:"com.kiwigrid.devices.em.EnergyManager",LOCATION:"com.kiwigrid.devices.location.Location",PV_PLANT:"com.kiwigrid.devices.pvplant.PVPlant"},ICON:{"com.kiwigrid.devices.batteryconverter.BatteryConverter":"kiwigrid-device-icon-battery-converter","com.kiwigrid.devices.plug.Plug":"kiwigrid-device-icon-plug","com.kiwigrid.devices.powermeter.PowerMeter":"kiwigrid-device-icon-plug","com.kiwigrid.devices.windturbine.WindTurbine":"kiwigrid-device-icon-wind-turbine","com.kiwigrid.devices.sensor.TemperatureSensor":"kiwigrid-device-icon-temperature-sensor","com.kiwigrid.devices.inverter.Inverter":"kiwigrid-device-icon-inverter","com.kiwigrid.devices.heatpump.HeatPump":"kiwigrid-device-icon-smart-heat-pump","com.kiwigrid.devices.microchp.MicroChpSystem":"kiwigrid-device-icon-micro-combined-heat-pump","com.kiwigrid.devices.ripplecontrolreceiver.RippleControlReceiver":"kiwigrid-device-icon-ripple-control-receiver","com.kiwigrid.devices.smartheatpumps.SmartHeatPumps":"kiwigrid-device-icon-smart-heat-pump","com.kiwigrid.devices.pvplant.PVPlant":"kiwigrid-device-icon-pv-plant"}}).provider("Device",function(){this.$get=function($q,$log,EventBusDispatcher,EventBusManager){var DeviceInstance=function(givenEventBus,properties){var that=this,eventBus=givenEventBus;angular.forEach(properties,function(value,key){that[key]=value,angular.isDefined(that.$pristine)||(that.$pristine={}),that.$pristine[key]=angular.copy(value)});var sendMessage=function(message){var deferred=$q.defer();return EventBusDispatcher.send(eventBus,"deviceservice",message,function(reply){EventBusManager.inDebugMode()&&$log.request(["deviceservice",message,reply],$log.ADVANCED_FORMATTER),reply.code===EventBusDispatcher.RESPONSE_CODE_OK?deferred.resolve(reply):deferred.reject(reply)}),deferred.promise},returnRejectedPromise=function(message){var deferred=$q.defer();return deferred.reject(message),deferred.promise};that.$update=function(){var changes={tagValues:{}};if(angular.forEach(that.tagValues,function(tagValue,tagName){angular.isDefined(that.$pristine.tagValues[tagName])&&angular.equals(that.tagValues[tagName].value,that.$pristine.tagValues[tagName].value)||(changes.tagValues[tagName]={},changes.tagValues[tagName].value=tagValue.value,changes.tagValues[tagName].oca=tagValue.oca)}),Object.keys(changes.tagValues).length){var deferred=$q.defer();return sendMessage({action:"mergeDevice",params:{deviceId:that.guid},body:changes}).then(function(reply){angular.isDefined(reply.result)&&angular.isDefined(reply.result.value)&&angular.isDefined(reply.result.value.tagValues)&&angular.forEach(reply.result.value.tagValues,function(tag){angular.isDefined(that.tagValues[tag.tagName])&&(that.$pristine.tagValues[tag.tagName]=angular.copy(that.tagValues[tag.tagName]))}),deferred.resolve(reply)},function(reply){deferred.reject(reply)}),deferred.promise}return returnRejectedPromise("No changes found")},that.$delete=function(){return sendMessage({action:"deleteDevice",params:{deviceId:that.guid}})},that.$reset=function(){angular.forEach(that,function(value,key){angular.isFunction(value)||"$pristine"===key||delete that[key]}),angular.forEach(that.$pristine,function(value,key){that[key]=angular.copy(value)})}},api={create:function(eventBus,properties){return new DeviceInstance(eventBus,properties)}};return api}}),angular.module("keta.services.EventBusDispatcher",["keta.services.AccessToken"]).provider("EventBusDispatcher",function(){this.$get=function($window,$timeout,AccessToken){var waitForOpen=function(eventBus,replied,success,error){var timeout=null;if(replied&&(timeout=$timeout(function(){error()},1e3*eventBus.getConfig().requestTimeout)),1!==eventBus.getInstance().readyState()){var onopen=null;angular.isFunction(eventBus.getInstance().onopen)&&(onopen=eventBus.getInstance().onopen),eventBus.getInstance().onopen=function(){angular.isFunction(onopen)&&onopen(),null!==timeout&&$timeout.cancel(timeout),success()}}else $timeout.cancel(timeout),success()},api={STATE_CONNECTING:0,STATE_OPEN:1,STATE_CLOSING:2,STATE_CLOSED:3,RESPONSE_CODE_OK:200,RESPONSE_MESSAGE_OK:"OK",RESPONSE_CODE_BAD_REQUEST:400,RESPONSE_MESSAGE_BAD_REQUEST:"Bad Request",RESPONSE_CODE_UNAUTHORIZED:401,RESPONSE_MESSAGE_UNAUTHORIZED:"Unauthorized",RESPONSE_CODE_NOT_FOUND:404,RESPONSE_MESSAGE_NOT_FOUND:"Not Found",RESPONSE_CODE_REQUEST_TIMEOUT:408,RESPONSE_MESSAGE_REQUEST_TIMEOUT:"Request Time-out",RESPONSE_CODE_AUTHENTICATION_TIMEOUT:419,RESPONSE_MESSAGE_AUTHENTICATION_TIMEOUT:"Authentication Timeout",RESPONSE_CODE_INTERNAL_SERVER_ERROR:500,RESPONSE_MESSAGE_INTERNAL_SERVER_ERROR:"Internal Server Error",RESPONSE_CODE_SERVICE_UNAVAILABLE:503,RESPONSE_MESSAGE_SERVICE_UNAVAILABLE:"Service Unavailable",send:function(eventBus,address,message,replyHandler){message.accessToken=AccessToken.get();var handler=function(reply){reply&&419===reply.code?AccessToken.refresh().then(function(response){angular.isDefined(response.data.accessToken)?(AccessToken.set(response.data.accessToken),api.send(eventBus,address,message,replyHandler)):$window.location.reload()},function(){$window.location.reload()}):angular.isFunction(replyHandler)&&replyHandler(reply)};angular.isDefined(replyHandler)&&angular.isFunction(replyHandler)?waitForOpen(eventBus,!0,function(){eventBus.getInstance().send(address,message,handler)},function(){replyHandler({code:408,message:"Request Time-out"})}):eventBus.getInstance().send(address,message,handler)},publish:function(eventBus,address,message){message.accessToken=AccessToken.get(),waitForOpen(eventBus,!1,function(){eventBus.getInstance().publish(address,message)})},registerHandler:function(eventBus,address,handler){waitForOpen(eventBus,!1,function(){eventBus.getInstance().registerHandler(address,handler)})},unregisterHandler:function(eventBus,address,handler){waitForOpen(eventBus,!1,function(){eventBus.getInstance().unregisterHandler(address,handler)})},close:function(eventBus){eventBus.getInstance().close()},readyState:function(eventBus){return eventBus.getInstance().readyState()},generateUUID:function(){var HEX_RANGE=16,BIT_HALF=8,BIT_SHIFT=3;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a,b){return b=Math.random()*HEX_RANGE,("y"===a?b&BIT_SHIFT|BIT_HALF:0|b).toString(HEX_RANGE)})}};return api}}),angular.module("keta.services.EventBusManager",[]).provider("EventBusManager",function(){var that=this,eventBuses={},debug=!1;this.add=function(eventBus){return eventBuses[eventBus.getConfig().id]=eventBus,that},this.remove=function(eventBus){return angular.isDefined(eventBuses[eventBus.getConfig().id])&&delete eventBuses[eventBus.getConfig().id],that},this.removeAll=function(){return eventBuses={},that},this.get=function(eventBusId){return angular.isDefined(eventBuses[eventBusId])?eventBuses[eventBusId]:null},this.getAll=function(){return eventBuses},this.enableDebug=function(){debug=!0},this.disableDebug=function(){debug=!1},this.inDebugMode=function(){return debug===!0},this.$get=function(){var api={add:this.add,remove:this.remove,removeAll:this.removeAll,get:this.get,getAll:this.getAll,enableDebug:this.enableDebug,disableDebug:this.disableDebug,inDebugMode:this.inDebugMode};return api}}),angular.module("keta.services.EventBus",[]).provider("EventBus",function(){var EventBus=function(givenConfig){var DEFAULT_CONFIG={id:"kiwibus",url:"https://localhost:10443/kiwibus",reconnect:!0,reconnectTimeout:5,requestTimeout:10};this.getDefaultConfig=function(){return DEFAULT_CONFIG};var config=angular.extend({},DEFAULT_CONFIG,givenConfig);this.getConfig=function(){return config};var eb=null;this.getInstance=function(){return eb};var init=function(){eb=new vertx.EventBus(config.url),eb.onclose=function(){config.reconnect&&window.setTimeout(function(){init()},1e3*config.reconnectTimeout)}};init()};this.create=function(config){return new EventBus(config)},this.$get=function(){}}),angular.module("keta.services.Logger",["keta.services.AppContext"]).config(function($provide,AppContextProvider){$provide.decorator("$log",function($delegate){$delegate.LOG_LEVEL_LOG=1,$delegate.LOG_LEVEL_DEBUG=2,$delegate.LOG_LEVEL_INFO=4,$delegate.LOG_LEVEL_WARN=8,$delegate.LOG_LEVEL_ERROR=16;var decorateLogger=function(originalFn,bitValue){return function(){var args=Array.prototype.slice.call(arguments);(null===AppContextProvider.get("common.logLevel")||0===AppContextProvider.get("common.logLevel")||(AppContextProvider.get("common.logLevel")&bitValue)===bitValue)&&originalFn.apply(null,args)}};return angular.forEach(["log","debug","info","warn","error"],function(o){var bitValue=$delegate["LOG_LEVEL_"+o.toUpperCase()];$delegate[o]=decorateLogger($delegate[o],bitValue),$delegate[o].logs=[]}),$delegate.ADVANCED_FORMATTER=function(messages){angular.isArray(messages)||(messages=[messages]);var output="%c["+(new Date).toISOString()+"]\n%c";angular.forEach(messages,function(message){output+=JSON.stringify(message,null,"	")+"\n"}),$delegate.log(output,"color:#acbf2f;font-weight:bold;","color:#333;font-weight:normal;")},$delegate.request=function(messages,formatter){angular.isDefined(formatter)&&angular.isFunction(formatter)?formatter(messages):$delegate.log(messages)},$delegate.event=function(messages,formatter){$delegate.request(messages,formatter)},$delegate})}),angular.module("keta.services.TagSet",["keta.services.Tag"]).provider("TagSet",function(){this.$get=function(){var TagSetInstance=function(){var that=this,tags=[],tagsAsHierarchy={};that.getTags=function(){return tags},that.getTagsAsHierarchy=function(){return tagsAsHierarchy},that.add=function(tag){return angular.isDefined(tagsAsHierarchy[tag.getGuid()])&&angular.isDefined(tagsAsHierarchy[tag.getGuid()][tag.getName()])||(angular.isDefined(tagsAsHierarchy[tag.getGuid()])||(tagsAsHierarchy[tag.getGuid()]={}),tagsAsHierarchy[tag.getGuid()][tag.getName()]=tag,tags.push(tag)),that},that.remove=function(tag){return angular.isDefined(tagsAsHierarchy[tag.getGuid()][tag.getName()])&&(delete tagsAsHierarchy[tag.getGuid()][tag.getName()],0===Object.keys(tagsAsHierarchy[tag.getGuid()]).length&&delete tagsAsHierarchy[tag.getGuid()],tags.splice(tags.indexOf(tag),1)),that}},api={create:function(){return new TagSetInstance}};return api}}),angular.module("keta.services.Tag",[]).constant("TagConstants",{UNIT:{WATTS:"W",WATTHOURS:"Wh",PERCENT:"%",EURO:"€",DOLLAR:"$",POUND:"£",KILOMETER:"km"}}).provider("Tag",function(){this.$get=function(){var TagInstance=function(properties){var guid=angular.isDefined(properties.guid)?properties.guid:null;this.getGuid=function(){return guid};var name=angular.isDefined(properties.name)?properties.name:null;this.getName=function(){return name};var sampleRate=angular.isDefined(properties.sampleRate)&&properties.sampleRate>=5?properties.sampleRate:null;this.getSampleRate=function(){return sampleRate}},api={create:function(properties){return new TagInstance(properties)}};return api}}),angular.module("keta.services.UserSet",["keta.services.User"]).provider("UserSet",function(){var DEFAULT_OFFSET=0,DEFAULT_LIMIT=50;this.$get=function($q,$rootScope,$log,User,EventBusDispatcher,EventBusManager){var UserSetInstance=function(givenEventBus){var that=this,eventBus=givenEventBus,params={};that.filter=function(filter){return params.filter=filter,that},that.project=function(projection){return params.projection=projection,that},that.sort=function(sorting){return params.sorting=sorting,that},that.paginate=function(pagination){return angular.isDefined(pagination)?(params.offset=angular.isDefined(pagination.offset)?pagination.offset:DEFAULT_OFFSET,params.limit=angular.isDefined(pagination.limit)?pagination.limit:DEFAULT_LIMIT):(params.offset=DEFAULT_OFFSET,params.limit=DEFAULT_LIMIT),that},that.query=function(){var deferred=$q.defer();return EventBusDispatcher.send(eventBus,"userservice",{action:"getUsers",params:params},function(reply){reply?(reply.params=params,reply.code===EventBusDispatcher.RESPONSE_CODE_OK?(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)&&angular.forEach(reply.result.items,function(item,index){
reply.result.items[index]=User.create(eventBus,item)}),EventBusManager.inDebugMode()&&$log.request(["userservice",{action:"getUsers",params:params},reply],$log.ADVANCED_FORMATTER),deferred.resolve(reply),$rootScope.$digest()):deferred.reject(reply)):deferred.reject("Something bad happened. Got no reply.")}),deferred.promise}},api={create:function(eventBus){return new UserSetInstance(eventBus)},indexOf:function(set,user){var index=-1;return angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.forEach(set.result.items,function(item,key){item.userId===user.userId&&(index=key)}),index},length:function(set){var length=angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.isArray(set.result.items)?set.result.items.length:0;return length},get:function(set,index){var user=angular.isDefined(set.result)&&angular.isDefined(set.result.items)&&angular.isDefined(set.result.items[index])?set.result.items[index]:null;return user},getAll:function(set){var users=angular.isDefined(set.result)&&angular.isDefined(set.result.items)?set.result.items:[];return users}};return api}}),angular.module("keta.services.User",["keta.services.EventBusDispatcher","keta.services.EventBusManager","keta.services.Logger"]).provider("User",function(){this.$get=function($q,$log,EventBusDispatcher,EventBusManager){var sendMessage=function(eventBus,message){var deferred=$q.defer();return EventBusDispatcher.send(eventBus,"userservice",message,function(reply){EventBusManager.inDebugMode()&&$log.request(["userservice",message,reply],$log.ADVANCED_FORMATTER),reply.code===EventBusDispatcher.RESPONSE_CODE_OK?deferred.resolve(reply):deferred.reject(reply)}),deferred.promise},returnRejectedPromise=function(message){var deferred=$q.defer();return deferred.reject(message),deferred.promise},UserInstance=function(givenEventBus,properties){var that=this,eventBus=givenEventBus;angular.forEach(properties,function(value,key){that[key]=value,angular.isDefined(that.$pristine)||(that.$pristine={}),that.$pristine[key]=angular.copy(value)}),that.$create=function(){var cleanedUser={};for(var el in that)that.hasOwnProperty(el)&&!angular.isFunction(that[el])&&"$pristine"!==el&&(cleanedUser[el]=angular.copy(that[el]));return sendMessage(eventBus,{action:"createUser",params:{userId:cleanedUser.userId},body:cleanedUser})},that.$update=function(){var cleanedUser=angular.copy(that),cleanedUserOriginal=angular.copy(that.$pristine);delete cleanedUser.$pristine,delete cleanedUser.$create,delete cleanedUser.$update,delete cleanedUser.$delete,delete cleanedUser.$reset;var changes={};if(angular.forEach(cleanedUser,function(value,key){"properties"===key?(angular.isDefined(cleanedUserOriginal.properties)||(cleanedUserOriginal.properties={}),angular.forEach(value,function(propValue,propKey){angular.isDefined(cleanedUserOriginal.properties[propKey])&&angular.equals(cleanedUser.properties[propKey],cleanedUserOriginal.properties[propKey])||(angular.isDefined(changes.properties)||(changes.properties={}),changes.properties[propKey]=propValue)})):angular.equals(cleanedUser[key],cleanedUserOriginal[key])||(changes[key]=value)}),Object.keys(changes).length){var deferred=$q.defer();return sendMessage(eventBus,{action:"mergeUser",params:{userId:that.userId},body:changes}).then(function(reply){that.$pristine={},angular.forEach(that,function(value,key){angular.isFunction(that[key])||(that.$pristine[key]=angular.copy(that[key]))}),deferred.resolve(reply)},function(reply){deferred.reject(reply)}),deferred.promise}return returnRejectedPromise("No changes found")},that.$delete=function(){return sendMessage(eventBus,{action:"deleteUser",params:{userId:that.userId}})},that.$reset=function(){angular.forEach(that,function(value,key){angular.isFunction(value)||"$pristine"===key||delete that[key]}),angular.forEach(that.$pristine,function(value,key){that[key]=angular.copy(value)})}},api={create:function(eventBus,properties){return new UserInstance(eventBus,properties)},getChannel:function(eventBus,channelId){var deferred=$q.defer();return sendMessage(eventBus,{action:"getChannel",params:{channelId:channelId}}).then(function(reply){deferred.resolve(reply)},function(reply){deferred.reject(reply)}),deferred.promise},getCurrent:function(eventBus){var deferred=$q.defer();return sendMessage(eventBus,{action:"getCurrentUser"}).then(function(reply){deferred.resolve(new UserInstance(eventBus,reply.result))},function(reply){deferred.reject(reply)}),deferred.promise}};return api}}),angular.module("keta.utils.Application",["keta.services.ApplicationSet","keta.utils.Common"]).factory("ApplicationUtils",function($log,$q,ApplicationSet,EventBusManager,CommonUtils){var deferred={getAppList:null};return{getAppName:function(labels,uiLocale){return CommonUtils.getLabelByLocale("name",labels,uiLocale)},getAppList:function(options){var DEFAULT_OPTIONS={eventBusId:"kiwibus",forceRefresh:!1,filter:{},excludeAppIds:{}},usedOptions=angular.extend({},DEFAULT_OPTIONS,options||{});return(null===deferred.getAppList||usedOptions.forceRefresh===!0)&&(deferred.getAppList=$q.defer(),ApplicationSet.create(EventBusManager.get(usedOptions.eventBusId)).filter(usedOptions.filter).query().then(function(reply){if(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)){var filteredApps=[];angular.forEach(reply.result.items,function(app){(angular.isDefined(app.appId)&&angular.isDefined(app.visible)&&app.visible===!0&&!angular.isDefined(usedOptions.excludeAppIds[app.appId])||usedOptions.excludeAppIds[app.appId]===!1&&angular.isString(app.entryUri)&&""!==app.entryUri&&CommonUtils.doesPropertyExist(app,"meta.i18n.en.name"))&&filteredApps.push(app)}),deferred.getAppList.resolve(filteredApps)}else{var errorMessage="Something bad happened. Got no reply.";deferred.getAppList.reject(errorMessage)}},function(){var errorMessage="Could not load application information.";deferred.getAppList.reject(errorMessage)})),deferred.getAppList.promise}}}),angular.module("keta.utils.Common",[]).factory("CommonUtils",function(){var factory={};return factory.doesPropertyExist=function(obj,prop){for(var parts=prop.split("."),i=0,l=parts.length;l>i;i++){var part=parts[i];if(!(angular.isObject(obj)&&part in obj))return!1;obj=obj[part]}return!0},factory.getLabelByLocale=function(key,labels,currentLocale){var LOCALE_LENGTH=2,label=null,shortLocale=angular.isString(currentLocale)&&currentLocale.length>=LOCALE_LENGTH?currentLocale.substr(0,LOCALE_LENGTH):"";return angular.isObject(labels[currentLocale])&&angular.isDefined(labels[currentLocale][key])?label=labels[currentLocale][key]:angular.isObject(labels[shortLocale])&&angular.isDefined(labels[shortLocale][key])?label=labels[shortLocale][key]:angular.isObject(labels.en)&&angular.isDefined(labels.en[key])&&(label=labels.en[key]),label},factory});
//# sourceMappingURL=keta.min.js.map