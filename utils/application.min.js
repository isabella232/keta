/**
 * keta 0.4.5
 * Build 2015-08-17T14:13:15.994Z
 *
 * Copyright Kiwigrid GmbH 2014-2015
 * http://kiwigrid.github.io/keta/
 *
 * Licensed under MIT License
 * https://raw.githubusercontent.com/kiwigrid/keta/master/LICENSE
 */
"use strict";angular.module("keta.utils.Application",["keta.services.ApplicationSet","keta.utils.Common"]).constant("ApplicationUtilsConstants",{MEDIA_TYPE_APPICON:"APPICON",AUTHOR_TYPE_SELLER:"SELLER"}).factory("ApplicationUtils",function($log,$q,ApplicationSet,EventBusManager,CommonUtils,ApplicationUtilsConstants){var deferred={getAppList:null};return{getAppName:function(labels,uiLocale){return CommonUtils.getLabelByLocale("name",labels,uiLocale)},getAppList:function(options){var DEFAULT_OPTIONS={eventBusId:"kiwibus",forceRefresh:!1,filter:{},excludeAppIds:{}},usedOptions=angular.extend({},DEFAULT_OPTIONS,options||{});return(null===deferred.getAppList||usedOptions.forceRefresh===!0)&&(deferred.getAppList=$q.defer(),ApplicationSet.create(EventBusManager.get(usedOptions.eventBusId)).filter(usedOptions.filter).query().then(function(reply){if(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)){var filteredApps=[];angular.forEach(reply.result.items,function(app){(angular.isDefined(app.appId)&&angular.isDefined(app.visible)&&app.visible===!0&&!angular.isDefined(usedOptions.excludeAppIds[app.appId])||usedOptions.excludeAppIds[app.appId]===!1&&angular.isString(app.entryUri)&&""!==app.entryUri&&CommonUtils.doesPropertyExist(app,"meta.i18n.en.name"))&&filteredApps.push(app)}),deferred.getAppList.resolve(filteredApps)}else{var errorMessage="Something bad happened. Got no reply.";deferred.getAppList.reject(errorMessage)}},function(){var errorMessage="Could not load application information.";deferred.getAppList.reject(errorMessage)})),deferred.getAppList.promise},getAppIcon:function(app,language){var appIcon=null;language=angular.isDefined(language)?language:"en";var mediaSource=CommonUtils.doesPropertyExist(app,"meta.i18n")&&angular.isDefined(app.meta.i18n[language])&&angular.isDefined(app.meta.i18n[language].media)?app.meta.i18n[language].media:null;if(null===mediaSource&&CommonUtils.doesPropertyExist(app,"meta.i18n.en.media")&&(mediaSource=app.meta.i18n.en.media),angular.isDefined(app.entryUri)){var link=document.createElement("a");link.href=app.entryUri,angular.forEach(mediaSource,function(media){angular.isDefined(media.type)&&media.type===ApplicationUtilsConstants.MEDIA_TYPE_APPICON&&angular.isDefined(media.src)&&(appIcon="/"!==link.origin[link.origin.length-1]&&"/"!==media.src[0]?link.origin+"/"+media.src:link.origin+media.src)})}return appIcon},getAppAuthor:function(app,type){var appAuthor=null;return type=angular.isDefined(type)?type:ApplicationUtilsConstants.AUTHOR_TYPE_SELLER,CommonUtils.doesPropertyExist(app,"meta.authors")&&(angular.forEach(app.meta.authors,function(author){author.type===type&&(appAuthor=author.name)}),null===appAuthor&&(appAuthor=app.meta.authors[0].name)),appAuthor}}});
//# sourceMappingURL=application.min.js.map