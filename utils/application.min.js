/**
 * keta 1.11.0
 * Build 2021-04-21T15:24:16.331Z
 *
 * Copyright Kiwigrid GmbH 2014-2021
 * http://kiwigrid.github.io/keta/
 *
 * Licensed under MIT License
 * https://raw.githubusercontent.com/kiwigrid/keta/master/LICENSE
 */
"use strict";angular.module("keta.utils.Application",["keta.services.ApplicationSet","keta.utils.Common"]).constant("ketaApplicationUtilsConstants",{ASSET_MEDIA_TYPE:{APPICON:"APPICON",FAVICON:"FAVICON",SCREENSHOT:"SCREENSHOT",TOUCHICON:"TOUCHICON",VIDEO:"VIDEO"},AUTHOR_TYPE:{DEVELOPER:"DEVELOPER",SELLER:"SELLER"}}).factory("ketaApplicationUtils",function($q,ketaApplicationSet,ketaEventBusManager,ketaCommonUtils,ketaApplicationUtilsConstants){var deferred={getAppList:null};return{getAppList:function(options){var DEFAULT_OPTIONS={eventBusId:"kiwibus",forceRefresh:!1,filter:{},excludeAppIds:{}},usedOptions=angular.extend({},DEFAULT_OPTIONS,options||{});return null!==deferred.getAppList&&!0!==usedOptions.forceRefresh||(deferred.getAppList=$q.defer(),ketaApplicationSet.create(ketaEventBusManager.get(usedOptions.eventBusId)).filter(usedOptions.filter).query().then(function(reply){if(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)){var filteredApps=[];angular.forEach(reply.result.items,function(app){(angular.isDefined(app.appId)&&angular.isDefined(app.visible)&&!0===app.visible&&!angular.isDefined(usedOptions.excludeAppIds[app.appId])||!1===usedOptions.excludeAppIds[app.appId]&&angular.isString(app.entryUri)&&""!==app.entryUri&&ketaCommonUtils.doesPropertyExist(app,"meta.i18n.en.name"))&&filteredApps.push(app)}),deferred.getAppList.resolve(filteredApps)}else{deferred.getAppList.reject("Something bad happened. Got no reply.")}},function(){deferred.getAppList.reject("Could not load application information.")})),deferred.getAppList.promise},getAppName:function(app,uiLocale){return ketaCommonUtils.doesPropertyExist(app,"meta.i18n")?ketaCommonUtils.getLabelByLocale("name",app.meta.i18n,uiLocale):null},getAppIcon:function(app,language){var appIcon=null,mediaSource=ketaCommonUtils.doesPropertyExist(app,"meta.i18n")&&angular.isDefined(app.meta.i18n[language])&&angular.isDefined(app.meta.i18n[language].media)?app.meta.i18n[language].media:null;if(null===mediaSource){var languageShort=angular.isDefined(language)?language.substr(0,2):"en";mediaSource=ketaCommonUtils.doesPropertyExist(app,"meta.i18n")&&angular.isDefined(app.meta.i18n[languageShort])&&angular.isDefined(app.meta.i18n[languageShort].media)?app.meta.i18n[languageShort].media:null}if(null===mediaSource&&ketaCommonUtils.doesPropertyExist(app,"meta.i18n.en.media")&&(mediaSource=app.meta.i18n.en.media),angular.isDefined(app.entryUri)){var link=document.createElement("a");link.href=app.entryUri;var params=app.entryUri.split("?")[1];params=params?"?"+params:"";var linkProtocol=link.protocol+(":"===link.protocol[link.protocol.length-1]?"//":"://"),linkPort=""!==link.port&&"0"!==link.port?":"+link.port:"",linkOrigin=angular.isDefined(link.origin)?link.origin:linkProtocol+link.hostname+linkPort;angular.forEach(mediaSource,function(media){angular.isDefined(media.type)&&media.type===ketaApplicationUtilsConstants.ASSET_MEDIA_TYPE.APPICON&&angular.isDefined(media.src)&&(appIcon="/"!==linkOrigin[linkOrigin.length-1]&&"/"!==media.src[0]?linkOrigin+"/"+media.src:linkOrigin+media.src,appIcon+=params)})}return appIcon},getAppAuthor:function(app,type){var appAuthor=null;return type=angular.isDefined(type)?type:ketaApplicationUtilsConstants.AUTHOR_TYPE.SELLER,ketaCommonUtils.doesPropertyExist(app,"meta.authors")&&(angular.forEach(app.meta.authors,function(author){author.type===type&&(appAuthor=author.name)}),null===appAuthor&&(appAuthor=app.meta.authors[0].name)),appAuthor}}});
//# sourceMappingURL=application.min.js.map