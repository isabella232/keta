/**
 * keta 0.6.7
 * Build 2016-10-13T09:31:27.037Z
 *
 * Copyright Kiwigrid GmbH 2014-2016
 * http://kiwigrid.github.io/keta/
 *
 * Licensed under MIT License
 * https://raw.githubusercontent.com/kiwigrid/keta/master/LICENSE
 */
"use strict";angular.module("keta.utils.Application",["keta.services.ApplicationSet","keta.utils.Common"]).constant("ApplicationUtilsConstants",{ASSET_MEDIA_TYPE:{APPICON:"APPICON",FAVICON:"FAVICON",SCREENSHOT:"SCREENSHOT",TOUCHICON:"TOUCHICON",VIDEO:"VIDEO"},AUTHOR_TYPE:{DEVELOPER:"DEVELOPER",SELLER:"SELLER"}}).factory("ApplicationUtils",function($q,ApplicationSet,EventBusManager,CommonUtils,ApplicationUtilsConstants){var deferred={getAppList:null};return{getAppList:function(options){var DEFAULT_OPTIONS={eventBusId:"kiwibus",forceRefresh:!1,filter:{},excludeAppIds:{}},usedOptions=angular.extend({},DEFAULT_OPTIONS,options||{});return(null===deferred.getAppList||usedOptions.forceRefresh===!0)&&(deferred.getAppList=$q.defer(),ApplicationSet.create(EventBusManager.get(usedOptions.eventBusId)).filter(usedOptions.filter).query().then(function(reply){if(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)){var filteredApps=[];angular.forEach(reply.result.items,function(app){(angular.isDefined(app.appId)&&angular.isDefined(app.visible)&&app.visible===!0&&!angular.isDefined(usedOptions.excludeAppIds[app.appId])||usedOptions.excludeAppIds[app.appId]===!1&&angular.isString(app.entryUri)&&""!==app.entryUri&&CommonUtils.doesPropertyExist(app,"meta.i18n.en.name"))&&filteredApps.push(app)}),deferred.getAppList.resolve(filteredApps)}else{var errorMessage="Something bad happened. Got no reply.";deferred.getAppList.reject(errorMessage)}},function(){var errorMessage="Could not load application information.";deferred.getAppList.reject(errorMessage)})),deferred.getAppList.promise},getAppName:function(app,uiLocale){return CommonUtils.doesPropertyExist(app,"meta.i18n")?CommonUtils.getLabelByLocale("name",app.meta.i18n,uiLocale):null},getAppIcon:function(app,language){var appIcon=null,LOCALE_SHORT_LENGTH=2,mediaSource=CommonUtils.doesPropertyExist(app,"meta.i18n")&&angular.isDefined(app.meta.i18n[language])&&angular.isDefined(app.meta.i18n[language].media)?app.meta.i18n[language].media:null;if(null===mediaSource){var languageShort=angular.isDefined(language)?language.substr(0,LOCALE_SHORT_LENGTH):"en";mediaSource=CommonUtils.doesPropertyExist(app,"meta.i18n")&&angular.isDefined(app.meta.i18n[languageShort])&&angular.isDefined(app.meta.i18n[languageShort].media)?app.meta.i18n[languageShort].media:null}if(null===mediaSource&&CommonUtils.doesPropertyExist(app,"meta.i18n.en.media")&&(mediaSource=app.meta.i18n.en.media),angular.isDefined(app.entryUri)){var link=document.createElement("a");link.href=app.entryUri;var linkProtocol=link.protocol+(":"===link.protocol[link.protocol.length-1]?"//":"://"),linkPort=""!==link.port&&"0"!==link.port?":"+link.port:"",linkOrigin=angular.isDefined(link.origin)?link.origin:linkProtocol+link.hostname+linkPort;angular.forEach(mediaSource,function(media){angular.isDefined(media.type)&&media.type===ApplicationUtilsConstants.ASSET_MEDIA_TYPE.APPICON&&angular.isDefined(media.src)&&(appIcon="/"!==linkOrigin[linkOrigin.length-1]&&"/"!==media.src[0]?linkOrigin+"/"+media.src:linkOrigin+media.src)})}return appIcon},getAppAuthor:function(app,type){var appAuthor=null;return type=angular.isDefined(type)?type:ApplicationUtilsConstants.AUTHOR_TYPE.SELLER,CommonUtils.doesPropertyExist(app,"meta.authors")&&(angular.forEach(app.meta.authors,function(author){author.type===type&&(appAuthor=author.name)}),null===appAuthor&&(appAuthor=app.meta.authors[0].name)),appAuthor}}});
//# sourceMappingURL=application.min.js.map