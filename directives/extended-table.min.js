"use strict";angular.module("keta.directives.ExtendedTable",["ngSanitize","keta.shared","keta.filters.OrderObjectBy","keta.filters.Slice"]).directive("extendedTable",function($compile,$filter,ketaSharedConfig){return{restrict:"EA",replace:!0,scope:{rows:"=",labels:"=?",disabledComponents:"=?",switchableColumns:"=?",groupByProperty:"=?",orderByProperty:"=?",visibleColumns:"=?",headerLabelCallback:"=?",operationsMode:"=?",rowSortEnabled:"=?",rowSortCriteria:"=?",rowSortOrderAscending:"=?",actionList:"=?",cellRenderer:"=?",columnClassCallback:"=?",pager:"=?",search:"=?",searchResults:"=?"},templateUrl:"/components/directives/extended-table.html",link:function(scope){scope.rows=angular.isDefined(scope.rows)&&angular.isArray(scope.rows)?scope.rows:[];var defaultLabels={SEARCH:"Search",ADD_COLUMN:"Add column",REMOVE_COLUMN:"Remove column",SORT:"Sort",NO_ENTRIES:"No entries"};scope.labels=angular.extend(defaultLabels,scope.labels),scope.headers=angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?scope.rows[0]:{},scope.disabledComponents=scope.disabledComponents||[scope.COMPONENTS_FILTER,scope.COMPONENTS_SELECTOR,scope.COMPONENTS_PAGER],scope.switchableColumns=scope.switchableColumns||[],scope.resetSelectedColumn(),scope.groupByProperty=scope.groupByProperty||null,scope.orderByProperty=scope.orderByProperty||"",scope.visibleColumns=scope.visibleColumns||(angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?Object.keys(scope.rows[0]):[]),scope.headerLabelCallback=scope.headerLabelCallback||function(column){return column},scope.operationsMode=scope.operationsMode||scope.OPERATIONS_MODE_VIEW,scope.rowSortEnabled=angular.isDefined(scope.rowSortEnabled)?scope.rowSortEnabled:!1,scope.rowSortCriteria=scope.rowSortCriteria||(angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?Object.keys(scope.rows[0])[0]:null),scope.rowSortOrderAscending=angular.isDefined(scope.rowSortOrderAscending)?scope.rowSortOrderAscending:!0,scope.actionList=scope.actionList||[],scope.cellRenderer=scope.cellRenderer||function(row,column){return angular.isDefined(row[column])?row[column]:null},scope.columnClassCallback=scope.columnClassCallback||function(){return""};var defaultPager={};defaultPager[scope.PAGER_TOTAL]=scope.rows.length,defaultPager[scope.PAGER_LIMIT]=scope.rows.length,defaultPager[scope.PAGER_OFFSET]=0,scope.pager=angular.extend(defaultPager,scope.pager),scope.resetPager(),scope.search=scope.search||null,scope.searchResults=scope.searchResults||scope.rows},controller:function($scope){$scope.COMPONENTS_FILTER=ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.FILTER,$scope.COMPONENTS_SELECTOR=ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.SELECTOR,$scope.COMPONENTS_TABLE=ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.TABLE,$scope.COMPONENTS_PAGER=ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.PAGER,$scope.OPERATIONS_MODE_DATA=ketaSharedConfig.EXTENDED_TABLE.OPERATIONS_MODE.DATA,$scope.OPERATIONS_MODE_VIEW=ketaSharedConfig.EXTENDED_TABLE.OPERATIONS_MODE.VIEW,$scope.PAGER_TOTAL=ketaSharedConfig.EXTENDED_TABLE.PAGER.TOTAL,$scope.PAGER_LIMIT=ketaSharedConfig.EXTENDED_TABLE.PAGER.LIMIT,$scope.PAGER_OFFSET=ketaSharedConfig.EXTENDED_TABLE.PAGER.OFFSET,$scope.pages=[],$scope.currentPage=0,$scope.selectedColumn=null;var update=function(){angular.isDefined($scope.rows)&&angular.isDefined($scope.rows[0])?(angular.equals($scope.headers,{})&&($scope.headers=$scope.rows[0]),angular.equals($scope.visibleColumns,[])&&($scope.visibleColumns=Object.keys($scope.rows[0])),null===$scope.rowSortCriteria&&($scope.rowSortCriteria=Object.keys($scope.rows[0])[0])):($scope.headers={},$scope.visibleColumns=[],$scope.rowSortCriteria=null)},inArray=function(array,element){var found=!1;return angular.forEach(array,function(item){item===element&&(found=!0)}),found};$scope.resetPager=function(){if($scope.operationsMode===$scope.OPERATIONS_MODE_VIEW){var rowsLength=null!==$scope.search?$filter("filter")($scope.rows,$scope.search).length:$scope.rows.length;$scope.pager[$scope.PAGER_TOTAL]=rowsLength,0===$scope.pager[$scope.PAGER_LIMIT]&&($scope.pager[$scope.PAGER_LIMIT]=rowsLength),$scope.pager[$scope.PAGER_OFFSET]>rowsLength-1&&($scope.pager[$scope.PAGER_OFFSET]=0)}if(angular.isNumber($scope.pager[$scope.PAGER_TOTAL])&&angular.isNumber($scope.pager[$scope.PAGER_LIMIT])){$scope.pages=[];for(var numOfPages=Math.ceil($scope.pager[$scope.PAGER_TOTAL]/$scope.pager[$scope.PAGER_LIMIT]),i=0;numOfPages>i;i++)$scope.pages.push(i+1)}angular.isNumber($scope.pager[$scope.PAGER_LIMIT])&&angular.isNumber($scope.pager[$scope.PAGER_OFFSET])&&($scope.currentPage=Math.floor($scope.pager[$scope.PAGER_OFFSET]/$scope.pager[$scope.PAGER_LIMIT])+1)},$scope.resetSelectedColumn=function(){var possibleColumns=$filter("filter")($scope.switchableColumns,function(column){return!inArray($scope.visibleColumns,column.id)}),stillPossible=!1;angular.forEach(possibleColumns,function(column){column.id===$scope.selectedColumn&&(stillPossible=!0)}),stillPossible||(possibleColumns=$filter("orderBy")(possibleColumns,$scope.orderByProperty),$scope.selectedColumn=angular.isDefined(possibleColumns[0])?possibleColumns[0].id:null)},$scope.$watch("rows",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&(update(),$scope.resetPager())},!0),$scope.$watch("pager",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&$scope.resetPager()},!0),$scope.$watch("search",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&($scope.resetPager(),$scope.searchResults=$filter("filter")($scope.rows,$scope.searchIn))}),$scope.$watch("switchableColumns",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&$scope.resetSelectedColumn()},!0),$scope.isDisabled=function(key){return inArray($scope.disabledComponents,key)},$scope.isSwitchable=function(key){var switchable=!1;return angular.forEach($scope.switchableColumns,function(column){column.id===key&&(switchable=!0)}),switchable},$scope.isSortCriteria=function(key){return null!==$scope.rowSortCriteria?key===$scope.rowSortCriteria:!1},$scope.sortBy=function(column){$scope.rowSortEnabled&&null!==$scope.headerLabelCallback(column)&&""!==$scope.headerLabelCallback(column)&&($scope.rowSortCriteria===column?$scope.rowSortOrderAscending=!$scope.rowSortOrderAscending:$scope.rowSortCriteria=column)},$scope.searchIn=function(row){if(!angular.isDefined($scope.search)||null===$scope.search||""===$scope.search)return!0;var match=!1;return angular.forEach($scope.visibleColumns,function(column){if(angular.isDefined(row[column])&&null!==row[column])if(angular.isObject(row[column])&&!angular.isArray(row[column])){var deepMatch=!1;angular.forEach(row[column],function(prop){-1!==String(prop).toLowerCase().indexOf($scope.search.toLowerCase())&&(deepMatch=!0)}),deepMatch===!0&&(match=!0)}else-1!==String(row[column]).toLowerCase().indexOf($scope.search.toLowerCase())&&(match=!0)}),match},$scope.filterColumns=function(column){return!inArray($scope.visibleColumns,column.id)},$scope.addColumn=function(column){$scope.visibleColumns.push(column),$scope.resetSelectedColumn()},$scope.removeColumn=function(column){var columns=[];angular.forEach($scope.visibleColumns,function(col){col!==column&&columns.push(col)}),$scope.visibleColumns=columns,$scope.resetSelectedColumn()},$scope.goToPage=function(page){$scope.pager[$scope.PAGER_OFFSET]=$scope.pager[$scope.PAGER_LIMIT]*(page-1),$scope.resetPager()}}}});
//# sourceMappingURL=extended-table.min.js.map