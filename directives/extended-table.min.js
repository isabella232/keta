/**
 * keta 0.4.9
 * Build 2015-10-05T08:59:54.638Z
 *
 * Copyright Kiwigrid GmbH 2014-2015
 * http://kiwigrid.github.io/keta/
 *
 * Licensed under MIT License
 * https://raw.githubusercontent.com/kiwigrid/keta/master/LICENSE
 */
"use strict";angular.module("keta.directives.ExtendedTable",["ngSanitize","keta.filters.OrderObjectBy","keta.filters.Slice","keta.filters.Unit","keta.utils.Common"]).constant("ExtendedTableConstants",{COMPONENT:{TABLE:"table",FILTER:"filter",SELECTOR:"selector",PAGER:"pager"},OPERATIONS_MODE:{DATA:"data",VIEW:"view"},PAGER:{TOTAL:"total",LIMIT:"limit",OFFSET:"offset"},ACTION_LIST_TYPE:{LINK:"link",ACTION:"action"}}).constant("ExtendedTableMessageKeys",{en:{"__keta.directives.ExtendedTable_search":"Search","__keta.directives.ExtendedTable_add_column":"Add column","__keta.directives.ExtendedTable_remove_column":"Remove column","__keta.directives.ExtendedTable_sort":"Sort","__keta.directives.ExtendedTable_no_entries":"No entries","__keta.directives.ExtendedTable_of":"of"},de:{"__keta.directives.ExtendedTable_search":"Suche","__keta.directives.ExtendedTable_add_column":"Spalte hinzufügen","__keta.directives.ExtendedTable_remove_column":"Spalte entfernen","__keta.directives.ExtendedTable_sort":"Sortieren","__keta.directives.ExtendedTable_no_entries":"Keine Einträge","__keta.directives.ExtendedTable_of":"von"}}).directive("extendedTable",function($compile,$filter,ExtendedTableConstants,ExtendedTableMessageKeys,CommonUtils){return{restrict:"EA",replace:!0,scope:{rows:"=",currentLocale:"=?",labels:"=?",disabledComponents:"=?",switchableColumns:"=?",groupByProperty:"=?",orderByProperty:"=?",visibleColumns:"=?",headerLabelCallback:"=?",operationsMode:"=?",rowSortEnabled:"=?",rowSortCriteria:"=?",rowSortOrderAscending:"=?",actionList:"=?",cellRenderer:"=?",columnClassCallback:"=?",tableClassCallback:"=?",pager:"=?",search:"=?",searchResults:"=?"},templateUrl:"/components/directives/extended-table.html",link:function(scope){scope.rows=angular.isDefined(scope.rows)&&angular.isArray(scope.rows)?scope.rows:[],scope.currentLocale=scope.currentLocale||"en",scope.MESSAGE_KEY_PREFIX="__keta.directives.ExtendedTable",scope.labels=angular.extend(ExtendedTableMessageKeys,scope.labels),scope.getLabel=function(key){return CommonUtils.getLabelByLocale(key,scope.labels,scope.currentLocale)},scope.headers=angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?scope.rows[0]:{},scope.disabledComponents=scope.disabledComponents||[scope.COMPONENTS_FILTER,scope.COMPONENTS_SELECTOR,scope.COMPONENTS_PAGER],scope.switchableColumns=scope.switchableColumns||[],scope.resetSelectedColumn(),scope.groupByProperty=scope.groupByProperty||null,scope.orderByProperty=scope.orderByProperty||"",scope.visibleColumns=scope.visibleColumns||(angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?Object.keys(scope.rows[0]):[]),scope.headerLabelCallback=scope.headerLabelCallback||function(column){return column},scope.operationsMode=scope.operationsMode||scope.OPERATIONS_MODE_VIEW,scope.rowSortEnabled=angular.isDefined(scope.rowSortEnabled)?scope.rowSortEnabled:!1,scope.rowSortCriteria=scope.rowSortCriteria||(angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?Object.keys(scope.rows[0])[0]:null),scope.rowSortOrderAscending=angular.isDefined(scope.rowSortOrderAscending)?scope.rowSortOrderAscending:!0,scope.actionList=scope.actionList||[],scope.cellRenderer=scope.cellRenderer||function(row,column){return angular.isDefined(row[column])?row[column]:null},scope.columnClassCallback=scope.columnClassCallback||function(){return""},scope.tableClassCallback=scope.tableClassCallback||function(){return["table-striped"]};var defaultPager={};defaultPager[scope.PAGER_TOTAL]=scope.rows.length,defaultPager[scope.PAGER_LIMIT]=scope.rows.length,defaultPager[scope.PAGER_OFFSET]=0,scope.pager=angular.extend(defaultPager,scope.pager),scope.resetPager(),scope.search=scope.search||null,scope.searchResults=scope.searchResults||scope.rows},controller:function($scope){$scope.COMPONENTS_FILTER=ExtendedTableConstants.COMPONENT.FILTER,$scope.COMPONENTS_SELECTOR=ExtendedTableConstants.COMPONENT.SELECTOR,$scope.COMPONENTS_TABLE=ExtendedTableConstants.COMPONENT.TABLE,$scope.COMPONENTS_PAGER=ExtendedTableConstants.COMPONENT.PAGER,$scope.OPERATIONS_MODE_DATA=ExtendedTableConstants.OPERATIONS_MODE.DATA,$scope.OPERATIONS_MODE_VIEW=ExtendedTableConstants.OPERATIONS_MODE.VIEW,$scope.PAGER_TOTAL=ExtendedTableConstants.PAGER.TOTAL,$scope.PAGER_LIMIT=ExtendedTableConstants.PAGER.LIMIT,$scope.PAGER_OFFSET=ExtendedTableConstants.PAGER.OFFSET,$scope.ACTION_LIST_TYPE_LINK=ExtendedTableConstants.ACTION_LIST_TYPE.LINK,$scope.ACTION_LIST_TYPE_ACTION=ExtendedTableConstants.ACTION_LIST_TYPE.ACTION,$scope.pages=[],$scope.currentPage=0,$scope.selectedColumn=null;var fillAllKeys=function(objects){var keys=[];return angular.forEach(objects,function(obj){angular.forEach(obj,function(value,key){-1===keys.indexOf(key)&&keys.push(key)})}),angular.forEach(objects,function(obj){angular.forEach(keys,function(key){obj[key]=angular.isDefined(obj[key])?obj[key]:null})}),objects},update=function(){angular.isDefined($scope.rows)&&angular.isDefined($scope.rows[0])?($scope.rows=fillAllKeys($scope.rows),angular.equals($scope.headers,{})&&($scope.headers=$scope.rows[0]),angular.equals($scope.visibleColumns,[])&&($scope.visibleColumns=Object.keys($scope.rows[0])),null===$scope.rowSortCriteria&&($scope.rowSortCriteria=Object.keys($scope.rows[0])[0])):($scope.headers={},$scope.visibleColumns=[],$scope.rowSortCriteria=null)},inArray=function(array,element){var found=!1;return angular.forEach(array,function(item){item===element&&(found=!0)}),found};$scope.rows=fillAllKeys($scope.rows),$scope.resetPager=function(){var rowsLength=$scope.rows.length;if(null!==$scope.search&&($scope.searchResults=$filter("filter")($scope.rows,$scope.searchIn),rowsLength=$scope.searchResults.length),$scope.operationsMode===$scope.OPERATIONS_MODE_VIEW&&($scope.pager[$scope.PAGER_TOTAL]=rowsLength,0===$scope.pager[$scope.PAGER_LIMIT]&&($scope.pager[$scope.PAGER_LIMIT]=rowsLength),$scope.pager[$scope.PAGER_OFFSET]>rowsLength-1&&($scope.pager[$scope.PAGER_OFFSET]=0)),angular.isNumber($scope.pager[$scope.PAGER_TOTAL])&&angular.isNumber($scope.pager[$scope.PAGER_LIMIT])){$scope.pages=[];for(var numOfPages=Math.ceil($scope.pager[$scope.PAGER_TOTAL]/$scope.pager[$scope.PAGER_LIMIT]),i=0;numOfPages>i;i++)$scope.pages.push(i+1)}angular.isNumber($scope.pager[$scope.PAGER_LIMIT])&&angular.isNumber($scope.pager[$scope.PAGER_OFFSET])&&($scope.currentPage=Math.floor($scope.pager[$scope.PAGER_OFFSET]/$scope.pager[$scope.PAGER_LIMIT])+1)},$scope.resetSelectedColumn=function(){var possibleColumns=$filter("filter")($scope.switchableColumns,function(column){return!inArray($scope.visibleColumns,column.id)}),stillPossible=!1;angular.forEach(possibleColumns,function(column){column.id===$scope.selectedColumn&&(stillPossible=!0)}),stillPossible||(possibleColumns=$filter("orderBy")(possibleColumns,$scope.orderByProperty),$scope.selectedColumn=angular.isDefined(possibleColumns[0])?possibleColumns[0].id:null)},$scope.showActionListItem=function(item,row){var show=!0;return angular.isFunction(item.display)&&(show=item.display(row)),show},$scope.$watch("rows",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&(update(),$scope.resetPager())},!0),$scope.$watch("pager",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&$scope.resetPager()},!0),$scope.$watch("search",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&$scope.resetPager()}),$scope.$watch("switchableColumns",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&$scope.resetSelectedColumn()},!0),$scope.getTableClasses=function(){var configuredClasses=$scope.tableClassCallback();return configuredClasses.push("table"),configuredClasses.push("form-group"),configuredClasses.join(" ")},$scope.isDisabled=function(key){return inArray($scope.disabledComponents,key)},$scope.isSwitchable=function(key){var switchable=!1;return angular.forEach($scope.switchableColumns,function(column){column.id===key&&(switchable=!0)}),switchable},$scope.isSortCriteria=function(key){return null!==$scope.rowSortCriteria?key===$scope.rowSortCriteria:!1},$scope.sortBy=function(column){$scope.rowSortEnabled&&null!==$scope.headerLabelCallback(column)&&""!==$scope.headerLabelCallback(column)&&($scope.rowSortCriteria===column?$scope.rowSortOrderAscending=!$scope.rowSortOrderAscending:$scope.rowSortCriteria=column)},$scope.searchIn=function(row){return angular.isDefined($scope.search)&&null!==$scope.search&&""!==$scope.search?$scope.visibleColumns.some(function(column){if(angular.isDefined(row[column])&&null!==row[column]){if(angular.isObject(row[column])&&!angular.isArray(row[column])){var deepMatch=!1;return angular.forEach(row[column],function(prop){-1!==String(prop).toLowerCase().indexOf($scope.search.toLowerCase())&&(deepMatch=!0)}),deepMatch}if(-1!==String(row[column]).toLowerCase().indexOf($scope.search.toLowerCase()))return!0}}):!0},$scope.filterColumns=function(column){return!inArray($scope.visibleColumns,column.id)},$scope.addColumn=function(column){$scope.visibleColumns.push(column),$scope.resetSelectedColumn()},$scope.removeColumn=function(column){var columns=[];angular.forEach($scope.visibleColumns,function(col){col!==column&&columns.push(col)}),$scope.visibleColumns=columns,$scope.resetSelectedColumn()},$scope.goToPage=function(page){page>0&&page<=$scope.pages.length&&($scope.pager[$scope.PAGER_OFFSET]=$scope.pager[$scope.PAGER_LIMIT]*(page-1),$scope.resetPager())};var resetPagerInputIfNecessary=function(currentPage){var parsingRadix=10,pageAsNumber=parseInt(currentPage,parsingRadix),newPage=pageAsNumber;!angular.isNumber(pageAsNumber)||isNaN(pageAsNumber)||0>=pageAsNumber?newPage=1:pageAsNumber>$scope.pages.length&&(newPage=$scope.pages.length),$scope.goToPage(newPage)};$scope.checkPagerInput=function(currentPage,$event){switch($event.type){case"keypress":13===$event.keyCode&&resetPagerInputIfNecessary(currentPage);break;case"blur":resetPagerInputIfNecessary(currentPage)}}}}});
//# sourceMappingURL=extended-table.min.js.map