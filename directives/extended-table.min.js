"use strict";angular.module("keta.directives.ExtendedTable",["ngSanitize","keta.shared","keta.filters.OrderObjectBy","keta.filters.Slice"]).directive("extendedTable",function($compile,$filter,ketaSharedConfig){return{restrict:"EA",replace:!0,scope:{rows:"=",labels:"=?",disabledComponents:"=?",switchableColumns:"=?",visibleColumns:"=?",headerLabelCallback:"=?",operationsMode:"=?",rowSortEnabled:"=?",rowSortCriteria:"=?",rowSortOrderAscending:"=?",actionList:"=?",cellRenderer:"=?",columnClassCallback:"=?",pager:"=?",search:"=?"},templateUrl:"/components/directives/extended-table.html",link:function(scope){var update=function(){var defaultLabels={ADD_COLUMN:"Add column"};scope.labels=angular.extend(defaultLabels,scope.labels),scope.headers=angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?scope.rows[0]:{},scope.disabledComponents=scope.disabledComponents||[scope.COMPONENTS_FILTER,scope.COMPONENTS_SELECTOR,scope.COMPONENTS_PAGER],scope.switchableColumns=scope.switchableColumns||[],scope.visibleColumns=scope.visibleColumns||(angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?Object.keys(scope.rows[0]):[]),scope.headerLabelCallback=scope.headerLabelCallback||function(column){return column},scope.operationsMode=scope.operationsMode||scope.OPERATIONS_MODE_VIEW,scope.rowSortEnabled=angular.isDefined(scope.rowSortEnabled)?scope.rowSortEnabled:!1,scope.rowSortCriteria=scope.rowSortCriteria||(angular.isDefined(scope.rows)&&angular.isDefined(scope.rows[0])?Object.keys(scope.rows[0])[0]:null),scope.rowSortOrderAscending=angular.isDefined(scope.rowSortOrderAscending)?scope.rowSortOrderAscending:!0,scope.actionList=scope.actionList||[],scope.cellRenderer=scope.cellRenderer||function(row,column){return angular.isDefined(row[column])?row[column]:null},scope.columnClassCallback=scope.columnClassCallback||function(){return""};var defaultPager={};defaultPager[scope.PAGER_TOTAL]=angular.isArray(scope.rows)?scope.rows.length:0,defaultPager[scope.PAGER_LIMIT]=angular.isArray(scope.rows)?scope.rows.length:0,defaultPager[scope.PAGER_OFFSET]=0,scope.pager=scope.pager||defaultPager,scope.search=scope.search||null};update(),scope.$watchCollection("rows",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&update()})},controller:function($scope){$scope.COMPONENTS_FILTER=ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.FILTER,$scope.COMPONENTS_SELECTOR=ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.SELECTOR,$scope.COMPONENTS_TABLE=ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.TABLE,$scope.COMPONENTS_PAGER=ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.PAGER,$scope.OPERATIONS_MODE_DATA=ketaSharedConfig.EXTENDED_TABLE.OPERATIONS_MODE.DATA,$scope.OPERATIONS_MODE_VIEW=ketaSharedConfig.EXTENDED_TABLE.OPERATIONS_MODE.VIEW,$scope.PAGER_TOTAL=ketaSharedConfig.EXTENDED_TABLE.PAGER.TOTAL,$scope.PAGER_LIMIT=ketaSharedConfig.EXTENDED_TABLE.PAGER.LIMIT,$scope.PAGER_OFFSET=ketaSharedConfig.EXTENDED_TABLE.PAGER.OFFSET;var inArray=function(array,key){var found=!1;return angular.forEach(array,function(item){item===key&&(found=!0)}),found};$scope.isDisabled=function(key){return inArray($scope.disabledComponents,key)},$scope.isSwitchable=function(key){return inArray($scope.switchableColumns,key)},$scope.isSortCriteria=function(key){var criteria=angular.isDefined($scope.rowSortCriteria)?$scope.rowSortCriteria:null;return null===criteria||"+"!==criteria[0]&&"-"!==criteria[0]||(criteria=criteria.substr(1)),key===criteria},$scope.pages=[],$scope.currentPage=0;var resetPager=function(){if(angular.isDefined($scope.pager)&&null!==$scope.pager){if($scope.operationsMode===$scope.OPERATIONS_MODE_VIEW){var rows=$scope.rows||[],rowsLength=$filter("filter")(rows,$scope.search).length;$scope.pager[$scope.PAGER_TOTAL]=rowsLength,$scope.pager[$scope.PAGER_OFFSET]>rowsLength-1&&($scope.pager[$scope.PAGER_OFFSET]=0)}if(angular.isNumber($scope.pager[$scope.PAGER_TOTAL])&&angular.isNumber($scope.pager[$scope.PAGER_LIMIT])){$scope.pages=[];for(var numOfPages=Math.ceil($scope.pager[$scope.PAGER_TOTAL]/$scope.pager[$scope.PAGER_LIMIT]),i=0;numOfPages>i;i++)$scope.pages.push(i+1)}angular.isNumber($scope.pager[$scope.PAGER_LIMIT])&&angular.isNumber($scope.pager[$scope.PAGER_OFFSET])&&($scope.currentPage=Math.floor($scope.pager[$scope.PAGER_OFFSET]/$scope.pager[$scope.PAGER_LIMIT])+1)}};$scope.$watch("pager",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&resetPager()},!0),$scope.$watch("search",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&resetPager()}),resetPager(),$scope.sortBy=function(column){$scope.rowSortEnabled&&null!==$scope.headerLabelCallback(column)&&($scope.rowSortCriteria===column?$scope.rowSortOrderAscending=!$scope.rowSortOrderAscending:$scope.rowSortCriteria=column)},$scope.selectedColumn=null;var resetSelectedColumn=function(){var possibleColumns=$filter("filter")($scope.switchableColumns,$scope.filterColumns);inArray(possibleColumns,$scope.selectedColumn)||($scope.selectedColumn=angular.isDefined(possibleColumns[0])?possibleColumns[0]:null)};$scope.$watch("switchableColumns.length",function(newValue,oldValue){null!==newValue&&newValue!==oldValue&&resetSelectedColumn()}),$scope.filterColumns=function(column){return!inArray($scope.visibleColumns,column)},$scope.addColumn=function(column){$scope.visibleColumns.push(column),resetSelectedColumn()},$scope.removeColumn=function(column){var columns=[];angular.forEach($scope.visibleColumns,function(col){col!==column&&columns.push(col)}),$scope.visibleColumns=columns,resetSelectedColumn()},$scope.goToPage=function(page){$scope.pager[$scope.PAGER_OFFSET]=$scope.pager[$scope.PAGER_LIMIT]*(page-1),resetPager()}}}});
//# sourceMappingURL=extended-table.min.js.map