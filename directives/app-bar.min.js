"use strict";angular.module("keta.directives.AppBar",["keta.shared","keta.services.EventBusDispatcher","keta.services.EventBusManager","keta.services.DeviceSet","keta.services.UserSet"]).directive("appBar",function($rootScope,$window,$document,EventBusManager,DeviceSet,User,ketaSharedConfig){return{restrict:"EA",replace:!0,scope:{eventBusId:"=?",locales:"=?",labels:"=?",links:"=?",worlds:"=?",displayModes:"=?"},transclude:!0,templateUrl:"/components/directives/app-bar.html",link:function(scope,element){scope.user={},scope.menus={},scope.worlds=scope.worlds||[],scope.locales=scope.locales||[],scope.energyManagers=[],scope.eventBusId=scope.eventBusId||"kiwibus";var eventBus=EventBusManager.get(scope.eventBusId),STATES={HIDDEN:"hidden",FULL:"full",NONE:"none",COMPACT:"compact"},SIZES={XXS:"xxs",XS:"xs",SM:"sm",MD:"md",LG:"lg",ALL:"all"},DECIMAL_RADIX=10,HIDDEN_CLASS="hidden",HIDDEN_CLASS_PREFIX="hidden-",VISIBLE_CLASS_PREFIX="visible-",sizesNoneState={};sizesNoneState[SIZES.XXS]=STATES.NONE,sizesNoneState[SIZES.XS]=STATES.NONE,sizesNoneState[SIZES.SM]=STATES.NONE,sizesNoneState[SIZES.MD]=STATES.NONE,sizesNoneState[SIZES.LG]=STATES.NONE,sizesNoneState[SIZES.ALL]=STATES.NONE;var sizesDefaultState={};sizesDefaultState[SIZES.XXS]=STATES.NONE,sizesDefaultState[SIZES.XS]=STATES.HIDDEN,sizesDefaultState[SIZES.SM]=STATES.COMPACT,sizesDefaultState[SIZES.MD]=STATES.COMPACT,sizesDefaultState[SIZES.LG]=STATES.NONE,sizesDefaultState[SIZES.ALL]=STATES.NONE;var defaultDisplayModes={worldSwitcher:sizesNoneState,mainMenu:sizesNoneState,notificationsMenu:sizesNoneState,userMenu:sizesDefaultState,energyManagerMenu:sizesDefaultState,languageMenu:sizesDefaultState,settingsMenu:{}};defaultDisplayModes.settingsMenu[SIZES.XXS]=STATES.NONE,defaultDisplayModes.settingsMenu[SIZES.XS]=STATES.FULL,defaultDisplayModes.settingsMenu[SIZES.SM]=STATES.HIDDEN,defaultDisplayModes.settingsMenu[SIZES.MD]=STATES.HIDDEN,defaultDisplayModes.settingsMenu[SIZES.LG]=STATES.HIDDEN,defaultDisplayModes.settingsMenu[SIZES.ALL]=STATES.NONE;var mergeObjects=function(customObject,defaultObject){var value,result={};for(value in customObject)result[value]=value in defaultObject&&"object"==typeof customObject[value]&&null!==value?mergeObjects(customObject[value],defaultObject[value]):customObject[value];for(value in defaultObject)value in result||(result[value]=defaultObject[value]);return result};scope.displayModes=mergeObjects(scope.displayModes,defaultDisplayModes);var container=angular.element(element),navbarFirst=container.children()[0],navbarSecond=container.children()[1],navbarFirstHeight=navbarFirst.offsetHeight,navbarSecondHeight=navbarSecond.offsetHeight,navbarSecondMarginBottom=parseInt($window.getComputedStyle(navbarSecond,null).getPropertyValue("margin-bottom"),DECIMAL_RADIX),scrollContainerHeight=navbarFirstHeight+navbarSecondHeight+navbarSecondMarginBottom,defaultLabels={APP_TITLE:"Application",ALL_APPS:"All Apps",ENERGY_MANAGER:"Energy-Manager",ALL_ENERGY_MANAGERS:"All Energy-Managers",USER_PROFILE:"User Profile",USER_LOGOUT:"Logout",NOTIFICATIONS:"Notifications"};scope.labels=angular.isDefined(scope.labels)?mergeObjects(scope.labels,defaultLabels):defaultLabels;var defaultLinks={ALL_APPS:null,ALL_ENERGY_MANAGERS:null,USER_PROFILE:null,USER_LOGOUT:null};scope.TYPES={APPS:"APPS",ENERGY_MANAGER:"ENERGY_MANAGER"},scope.LIMITS={APPS:3,ENERGY_MANAGER:3};var PREDICATES={APPS:{field:"name",reverse:!1},ENERGY_MANAGER:{field:"name",reverse:!1}};scope.links=angular.isDefined(scope.links)?angular.extend(defaultLinks,scope.links):defaultLinks,scope.getClasses=function(menuName,elementType){var classes=[];return angular.isDefined(elementType)||(elementType="menu"),angular.isDefined(scope.menus[menuName])&&angular.isDefined(scope.menus[menuName].isOpen)&&scope.menus[menuName].isOpen&&classes.push("open"),angular.forEach(SIZES,function(size){var state=scope.displayModes[menuName][size];if(size===SIZES.ALL&&state===STATES.HIDDEN)return classes.push(HIDDEN_CLASS),!1;switch(elementType){case"menu":switch(state){case STATES.HIDDEN:classes.push(HIDDEN_CLASS_PREFIX+size);break;case STATES.FULL:classes.push(VISIBLE_CLASS_PREFIX+size)}break;case"label":state===STATES.COMPACT&&classes.push(HIDDEN_CLASS_PREFIX+size)}}),classes.join(" ")};var getDevices=function(){return scope.displayModes.energyManagerMenu[SIZES.ALL]===STATES.HIDDEN?!1:void(null!==eventBus&&angular.isDefined(scope.user.userId)&&DeviceSet.create(eventBus).filter({"deviceModel.deviceClass":{$in:[ketaSharedConfig.DEVICE_CLASSES.ENERGY_MANAGER]},owner:scope.user.userId}).project({tagValues:{IdName:1,SettingsNetworkMap:1}}).query().then(function(reply){if(angular.isDefined(reply.result)&&angular.isDefined(reply.result.items)){var energyManagers=[];angular.forEach(reply.result.items,function(item){var emIP=angular.isDefined(item.tagValues)&&angular.isDefined(item.tagValues.SettingsNetworkMap)&&angular.isDefined(item.tagValues.SettingsNetworkMap.value)&&angular.isDefined(item.tagValues.SettingsNetworkMap.value.ipv4)?item.tagValues.SettingsNetworkMap.value.ipv4:null;null!==emIP&&energyManagers.push({name:item.tagValues.IdName.value,link:"http://"+emIP})}),scope.energyManagers=energyManagers}}))},updateMenus=function(){scope.menus={settingsMenu:{isOpen:!1},worldSwitcher:{isOpen:!1},energyManagerMenu:{isOpen:!1},languageMenu:{isOpen:!1,activeEntry:scope.locales[0]||{}},userMenu:{isOpen:!1}}};updateMenus(),null!==eventBus&&scope.displayModes.userMenu[SIZES.ALL]!==STATES.HIDDEN&&User.getCurrent(eventBus).then(function(reply){scope.user=reply,getDevices()}),scope.order=function(type){var field=angular.isDefined(PREDICATES[type])?PREDICATES[type].field:"name";return function(item){return angular.isDefined(item[field])?item[field]:""}},scope.reverse=function(type){return angular.isDefined(PREDICATES[type])&&angular.isDefined(PREDICATES[type].reverse)?PREDICATES[type].reverse:!1},scope.scrollOverNavbarFirst=!1,angular.element($window).bind("scroll",function(){angular.isDefined(navbarFirst)&&(this.scrollY>navbarFirstHeight?(scope.scrollOverNavbarFirst=!0,element.css("height",scrollContainerHeight+"px")):(scope.scrollOverNavbarFirst=!1,element.css("height","auto")),scope.menus.worldSwitcher.isOpen=!1,scope.$digest())}),scope.toggleOpenState=function(menuName){if(angular.isDefined(scope.menus[menuName])){var currentState=angular.copy(scope.menus[menuName].isOpen);scope.closeAllMenus(),currentState===scope.menus[menuName].isOpen&&(scope.menus[menuName].isOpen=!scope.menus[menuName].isOpen)}},scope.closeAllMenus=function(){scope.menus.worldSwitcher.isOpen=!1,scope.menus.userMenu.isOpen=!1,scope.menus.energyManagerMenu.isOpen=!1,scope.menus.settingsMenu.isOpen=!1,scope.menus.languageMenu.isOpen=!1},scope.setLocale=function(locale){$rootScope.currentLocale=locale.code,scope.currentLocale=locale.code,scope.menus.languageMenu.activeEntry=locale,scope.closeAllMenus()},scope.$on("$locationChangeStart",function(){scope.closeAllMenus()}),scope.isActive=function(menuName,entry){return angular.isDefined(scope.menus[menuName])&&scope.menus[menuName].activeEntry===entry},scope.toggleSidebar=function($event,position){$event.stopPropagation(),scope.closeAllMenus(),position===ketaSharedConfig.SIDEBAR.POSITION_LEFT?$rootScope.$broadcast(ketaSharedConfig.EVENTS.TOGGLE_SIDEBAR_LEFT):position===ketaSharedConfig.SIDEBAR.POSITION_RIGHT&&$rootScope.$broadcast(ketaSharedConfig.EVENTS.TOGGLE_SIDEBAR_RIGHT)},$document.bind("click",function(event){var appBarHtml=element.html(),targetElementHtml=angular.element(event.target).html();-1===appBarHtml.indexOf(targetElementHtml)&&(scope.closeAllMenus(),scope.$digest())}),scope.$watch("energyManagers",function(newValue,oldValue){newValue!==oldValue&&updateMenus()})}}});
//# sourceMappingURL=app-bar.min.js.map