"use strict";angular.module("keta.services.Device",["keta.services.EventBusDispatcher"]).provider("Device",function(){this.$get=function($q,EventBusDispatcher){var DeviceInstance=function(givenEventBus,properties){var that=this,eventBus=givenEventBus;angular.forEach(properties,function(value,key){that[key]=value,angular.isDefined(that.$pristine)||(that.$pristine={}),that.$pristine[key]=angular.copy(value)});var sendMessage=function(message){var deferred=$q.defer();return EventBusDispatcher.send(eventBus,"devices",message,function(reply){200===reply.code?deferred.resolve(reply):deferred.reject(reply)}),deferred.promise},returnRejectedPromise=function(message){var deferred=$q.defer();return deferred.reject(message),deferred.promise};that.update=function(){var changes={tagValues:{}};if(angular.forEach(that.tagValues,function(tagValue,tagName){that.tagValues[tagName].value!==that.$pristine.tagValues[tagName].value&&(changes.tagValues[tagName]={},changes.tagValues[tagName].value=tagValue.value,changes.tagValues[tagName].oca=tagValue.oca+1)}),Object.keys(changes.tagValues).length){var deferred=$q.defer();return sendMessage({action:"updateDevice",params:{deviceId:that.guid},body:changes}).then(function(reply){angular.forEach(that.$pristine,function(value,key){that.$pristine[key]=angular.copy(that[key])}),deferred.resolve(reply)},function(reply){deferred.reject(reply)}),deferred.promise}return returnRejectedPromise("No changes found")},that["delete"]=function(){return sendMessage({action:"deleteDevice",params:{deviceId:that.guid}})}},api={create:function(eventBus,properties){return new DeviceInstance(eventBus,properties)}};return api}});
//# sourceMappingURL=device.min.js.map