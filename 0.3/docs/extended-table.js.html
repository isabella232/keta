<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>keta – Docs – Source: directives/extended-table.js</title>
	<meta name="description" content="jsDoc of Frontend Components for Kiwigrid Platform based AngularJS Apps">
	
	<link href="/keta/css/keta.min.css" rel="stylesheet">
	<link href="/keta/css/style.css" rel="stylesheet">
	<link href="/keta/css/docs.css" rel="stylesheet">
	<link href="/keta/css/prettify-tomorrow.css" rel="stylesheet">
	
	<!--[if lt IE 9]>
	<script src="/keta/js/html5shiv.min.js"></script>
	<script src="/keta/js/respond.min.js"></script>
	<![endif]-->
</head>
<body>
	<div class="col-xs-12 col-sm-12 col-md-3 sidebar">
		<p id="logo">
			<a href="/keta/"><img src="/keta/img/keta.svg"></a>
		</p>
		<p class="lead text-center">
			Frontend Components for Kiwigrid Platform based AngularJS Apps
		</p>
		<p class="text-center">
			Version 0.3.0
		</p>
		<p class="text-center hidden-xs hidden-sm">
			<a class="btn btn-primary" href="https://github.com/kiwigrid/keta/zipball/0.3.0" role="button">ZIP File</a>
			<a class="btn btn-primary" href="https://github.com/kiwigrid/keta/tarball/0.3.0" role="button">TAR Ball</a>
		</p>
		<p class="text-center visible-xs visible-sm">
			<a class="btn btn-lg btn-primary" href="https://github.com/kiwigrid/keta/zipball/0.3.0" role="button">ZIP File</a>
			<a class="btn btn-lg btn-primary" href="https://github.com/kiwigrid/keta/tarball/0.3.0" role="button">TAR Ball</a>
		</p>
		<ul class="nav nav-pills nav-stacked">
			<li><a href="../index.html">Home</a></li>
			<li><a href="../examples/">Examples</a></li>
			<li class="active"><a href="../docs/">Documentation</a></li>
		</ul>
		<p class="footer text-center hidden-xs hidden-sm">
			View the project on <a href="https://github.com/kiwigrid/keta">Github</a>.<br>
			Maintained by <a href="http://www.kiwigrid.com">Kiwigrid GmbH</a>.<br>
			Licensed under the <a href="https://raw.githubusercontent.com/kiwigrid/keta/master/LICENSE">MIT License</a>.
		</p>
		<p id="company" class="text-center hidden-xs hidden-sm">
			<a href="http://www.kiwigrid.com"><img src="/keta/img/kiwigrid.svg"></a>
		</p>
	</div>
	
	<div class="col-xs-12 col-sm-12 col-md-2 col-md-offset-3 index">
		<nav>
			<h1><a href="index.html">Index</a></h1><h3>Modules</h3><ul class="list-unstyled"><li><a href="ExtendedTable.html">ExtendedTable</a></li><li><a href="MainMenu.html">MainMenu</a></li><li><a href="Sidebar.html">Sidebar</a></li><li><a href="WorldBar.html">WorldBar</a></li><li><a href="OrderObjectBy.html">OrderObjectBy</a></li><li><a href="Slice.html">Slice</a></li><li><a href="Unit.html">Unit</a></li><li><a href="shared.html">shared</a></li><li><a href="AccessToken_.html">AccessToken</a></li><li><a href="AppContext_.html">AppContext</a></li><li><a href="Device_.html">Device</a></li><li><a href="DeviceEvent_.html">DeviceEvent</a></li><li><a href="DeviceSet_.html">DeviceSet</a></li><li><a href="EventBus_.html">EventBus</a></li><li><a href="EventBusDispatcher_.html">EventBusDispatcher</a></li><li><a href="EventBusManager_.html">EventBusManager</a></li><li><a href="Logger.html">Logger</a></li><li><a href="Tag.html">Tag</a></li><li><a href="TagSet.html">TagSet</a></li></ul><h3>Classes</h3><ul class="list-unstyled"><li><a href="AccessToken.html">AccessToken</a></li><li><a href="AppContext.html">AppContext</a></li><li><a href="AppContextProvider.html">AppContextProvider</a></li><li><a href="Device.html">Device</a></li><li><a href="DeviceEvent.html">DeviceEvent</a></li><li><a href="DeviceEventInstance.html">DeviceEventInstance</a></li><li><a href="DeviceEventProvider.html">DeviceEventProvider</a></li><li><a href="DeviceInstance.html">DeviceInstance</a></li><li><a href="DeviceProvider.html">DeviceProvider</a></li><li><a href="DeviceSet.html">DeviceSet</a></li><li><a href="DeviceSetInstance.html">DeviceSetInstance</a></li><li><a href="DeviceSetProvider.html">DeviceSetProvider</a></li><li><a href="EventBus.html">EventBus</a></li><li><a href="EventBusDispatcher.html">EventBusDispatcher</a></li><li><a href="EventBusDispatcherProvider.html">EventBusDispatcherProvider</a></li><li><a href="EventBusManager.html">EventBusManager</a></li><li><a href="EventBusManagerProvider.html">EventBusManagerProvider</a></li><li><a href="EventBusProvider.html">EventBusProvider</a></li><li><a href="ketaSharedFactory.html">ketaSharedFactory</a></li><li><a href="LoggerConfig.html">LoggerConfig</a></li><li><a href="LoggerDecorator.html">LoggerDecorator</a></li><li><a href="Tag_.html">Tag</a></li><li><a href="TagInstance.html">TagInstance</a></li><li><a href="TagProvider.html">TagProvider</a></li><li><a href="TagSet_.html">TagSet</a></li><li><a href="TagSetInstance.html">TagSetInstance</a></li><li><a href="TagSetProvider.html">TagSetProvider</a></li></ul>
		</nav>
	</div>
	
	<div class="col-xs-12 col-sm-12 col-md-7 canvas" id="#top">
		<h1 class="page-title">Source: directives/extended-table.js</h1>
		


    
    <section>
        <article>
            <pre class="prettyprint source"><code>'use strict';

/**
 * @name keta.directives.ExtendedTable
 * @author Marco Lehmann &lt;marco.lehmann@kiwigrid.com>
 * @copyright Kiwigrid GmbH 2014-2015
 * @module keta.directives.ExtendedTable
 * @description
 * &lt;p>
 *   A table directive with extended functionality as column sorting, column customizing, paging
 *   and filtering.
 * &lt;/p>
 * &lt;p>
 *   Basic principle is the usage of optional parameters and callbacks, which offer a really
 *   flexible API for customizing the table to you very own needs.
 * &lt;/p>
 * @example
 * &lt;div data-extended-table
 *     data-rows="rows"
 *     data-label-add-column="labelAddColumn"
 *     data-disabledComponents="disabledComponents"
 *     data-switchable-columns="switchableColumns"
 *     data-visible-columns="visibleColumns"
 *     data-header-label-callback="headerLabelCallback"
 *     data-operations-mode="operationsMode"
 *     data-row-sort-enabled="rowSortEnabled"
 *     data-row-sort-criteria="rowSortCriteria"
 *     data-row-sort-order-ascending="rowSortOrderAscending"
 *     data-action-list="actionList"
 *     data-cell-renderer="cellRenderer"
 *     data-column-class-callback="columnClassCallback"
 *     data-pager="pager"
 *     data-search="search"&gt;&lt;/div&gt;
 * @example
 * angular.module('exampleApp', ['keta.directives.ExtendedTable'])
 *     .controller('ExampleController', function($scope, ketaSharedConfig) {
 *         
 *         // data as array of objects, keys from first element are taken as headers
 *         $scope.rows = [{
 *             guid: 'guid-1',
 *             idName: 'Device 1',
 *             stateDevice: 'OK',
 *             deviceClass: 'class-1'
 *         }, {
 *             guid: 'guid-2',
 *             idName: 'Device 2',
 *             stateDevice: 'ERROR',
 *             deviceClass: 'class-2'
 *         }, {
 *             guid: 'guid-3',
 *             idName: 'Device 3',
 *             stateDevice: 'FATAL',
 *             deviceClass: 'class-3'
 *         }];
 *
 *         $scope.labelAddColumn = 'add col:';
 *
 *         // array of disabled components (empty by default)
 *         $scope.disabledComponents = [
 *             // the table itself
 *             ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.TABLE,
 *             // an input field to search throughout the full dataset
 *             ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.FILTER,
 *             // a selector to add columns to table
 *             ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.SELECTOR,
 *             // a pager to navigate through paged data
 *             ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.PAGER
 *         ];
 *         
 *         // array of switchable columns (empty by default)
 *         // together with selector component the given columns can be remove from
 *         // table and added to table afterwards
 *         $scope.switchableColumns = ['deviceClass'];
 *         
 *         // array of visible columns (full by default)
 *         // use this property to filter out columns like primary keys
 *         $scope.visibleColumns = ['idName', 'stateDevice', 'deviceClass'];
 *         
 *         // callback method to specify header labels (instead of using auto-generated ones)
 *         $scope.headerLabelCallback = function(column) {
 *             var mappings = {
 *                 idName: 'Name',
 *                 stateDevice: 'State',
 *                 deviceClass: 'Device Class'
 *             };
 *             return (angular.isDefined(mappings[column])) ? mappings[column] : column;
 *         };
 *         
 *         // operations mode ("view" for frontend or "data" for backend)
 *         // by defining operations mode as "view" the directive itself manages sorting,
 *         // paging and filtering; if you just pass a pre-sorted, pre-paged and pre-filtered
 *         // dataset by querying a backend, you have to use "data"
 *         $scope.operationsMode = ketaSharedConfig.EXTENDED_TABLE.OPERATIONS_MODE.VIEW;
 *         
 *         // boolean flag to enable or disable row sorting in frontend by showing appropriate icons
 *         $scope.rowSortEnabled = true;
 *         
 *         // criteria to sort for as string
 *         $scope.rowSortCriteria = 'idName';
 *         
 *         // boolean flag to determine if sort order is ascending (true by default)
 *         $scope.rowSortOrderAscending = true;
 *         
 *         // array of actions to render for each row
 *         // getLink method will be used to construct a link with the help of the row object,
 *         // label is used as value for title-tag,
 *         // icon is used as icon-class for visualizing the action
 *         $scope.actionList = [{
 *             getLink: function(row) {
 *                 return 'edit/' + row.guid;
 *             },
 *             label: 'Edit',
 *             icon: 'glyphicon glyphicon-pencil'
 *         }, {
 *             getLink: function(row) {
 *                 return 'remove/' + row.guid;
 *             },
 *             label: 'Remove',
 *             icon: 'glyphicon glyphicon-remove'
 *         }];
 *         
 *         // callback method to render each cell individually
 *         // with the help of this method you can overwrite default cell rendering behavior,
 *         // e.g. suppressing output for stateDevice property
 *         $scope.cellRenderer = function(row, column) {
 *             var value = angular.isDefined(row[column]) ? row[column] : null;
 *             if (column === 'stateDevice') {
 *                 value = '';
 *             }
 *             return value;
 *         };
 *         
 *         // callback method to return class attribute for each column
 *         // in this example together with cellRenderer the deviceState column is
 *         // expressed as just a table data element with css classes
 *         $scope.columnClassCallback = function(row, column, isHeader) {
 *             var columnClass = '';
 *             if (column === 'stateDevice') {
 *                 columnClass = 'state';
 *                 if (row.state === ketaSharedConfig.STATE.OK && !isHeader) {
 *                     columnClass+= ' state-success';
 *                 }
 *                 if (row.state === ketaSharedConfig.STATE.ERROR && !isHeader) {
 *                     columnClass+= ' state-warning';
 *                 }
 *                 if (row.state === ketaSharedConfig.STATE.FATAL && !isHeader) {
 *                     columnClass+= ' state-danger';
 *                 }
 *             }
 *             return columnClass;
 *         };
 *         
 *         // object for pager configuration (total, limit, offset)
 *         // with this configuration object you are able to manage paging
 *         // total is the total number of rows in the dataset
 *         // limit is the number of rows shown per page
 *         // offset is the index in the dataset to start from
 *         var pager = {};
 *         pager[ketaSharedConfig.EXTENDED_TABLE.PAGER.TOTAL] = $scope.allRows.length;
 *         pager[ketaSharedConfig.EXTENDED_TABLE.PAGER.LIMIT] = 5;
 *         pager[ketaSharedConfig.EXTENDED_TABLE.PAGER.OFFSET] = 0;
 *         $scope.pager = pager;
 *         
 *         // search term to filter the table
 *         // as two-way-binded property this variable contains the search string
 *         // typed by the user in the frontend and can therefor be used for querying
 *         // the backend, if watched here additionally
 *         $scope.search = null;
 *         
 *     });
 * 
 */
angular.module('keta.directives.ExtendedTable',
	[
		'ngSanitize',
		'keta.shared',
		'keta.filters.OrderObjectBy',
		'keta.filters.Slice'
	])
	
	.directive('extendedTable', function ExtendedTableDirective($compile, $filter, ketaSharedConfig) {
		return {
			restrict: 'EA',
			replace: true,
			scope: {
				
				// data as array of objects, keys from first element are taken as headers
				rows: '=',

				// label prefixed to selector-component
				labelAddColumn: '=?',
				
				// array of disabled components (empty by default)
				disabledComponents: '=?',
				
				// array of switchable columns (empty by default)
				switchableColumns: '=?',
				
				// array of visible columns (full by default)
				visibleColumns: '=?',
				
				// callback method to specify header labels (instead of using auto-generated ones)
				headerLabelCallback: '=?',
				
				// operations mode ("view" for frontend or "data" for backend)
				operationsMode: '=?',
				
				// boolean flag to enable or disable row sorting in frontend
				rowSortEnabled: '=?',
				
				// criteria to sort for as string
				rowSortCriteria: '=?',
				
				// boolean flag to enable ascending sort order for rows
				rowSortOrderAscending: '=?',
				
				// array of actions to render for each row
				actionList: '=?',
				
				// callback method to render each cell individually
				cellRenderer: '=?',
				
				// callback method to return class attribute for each column
				columnClassCallback: '=?',
				
				// object for pager configuration (total, limit, offset)
				pager: '=?',
				
				// search term to filter the table
				search: '=?'
				
			},
			templateUrl: '/components/directives/extended-table.html',
			controller: function($scope) {
				
				// CONSTANTS ---
				
				$scope.COMPONENTS_FILTER = ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.FILTER;
				$scope.COMPONENTS_SELECTOR = ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.SELECTOR;
				$scope.COMPONENTS_TABLE = ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.TABLE;
				$scope.COMPONENTS_PAGER = ketaSharedConfig.EXTENDED_TABLE.COMPONENTS.PAGER;
				
				$scope.OPERATIONS_MODE_DATA = ketaSharedConfig.EXTENDED_TABLE.OPERATIONS_MODE.DATA;
				$scope.OPERATIONS_MODE_VIEW = ketaSharedConfig.EXTENDED_TABLE.OPERATIONS_MODE.VIEW;
				
				$scope.PAGER_TOTAL = ketaSharedConfig.EXTENDED_TABLE.PAGER.TOTAL;
				$scope.PAGER_LIMIT = ketaSharedConfig.EXTENDED_TABLE.PAGER.LIMIT;
				$scope.PAGER_OFFSET = ketaSharedConfig.EXTENDED_TABLE.PAGER.OFFSET;
				
				// HELPER ---
				
				var inArray = function(array, key) {
					var found = false;
					angular.forEach(array, function(item) {
						if (item === key) {
							found = true;
						}
					});
					return found;
				};

				$scope.labelAddColumn = $scope.labelAddColumn || 'Add column';
				
				// CALLBACKS ---
				
				// headers to save
				$scope.headers =
					(angular.isDefined($scope.rows) && angular.isDefined($scope.rows[0])) ?
						$scope.rows[0] : {};
				
				// disabledComponents
				$scope.disabledComponents = $scope.disabledComponents || [
					$scope.COMPONENTS_FILTER,
					$scope.COMPONENTS_SELECTOR,
					$scope.COMPONENTS_PAGER
				];
				
				$scope.isDisabled = function(key) {
					return inArray($scope.disabledComponents, key);
				};
				
				// switchableColumns
				$scope.switchableColumns = $scope.switchableColumns || [];
				
				$scope.isSwitchable = function(key) {
					return inArray($scope.switchableColumns, key);
				};
				
				// visibleColumns
				$scope.visibleColumns =
					$scope.visibleColumns ||
					((angular.isDefined($scope.rows) && angular.isDefined($scope.rows[0])) ?
						Object.keys($scope.rows[0]) : []);
				
				// headerLabelCallback
				$scope.headerLabelCallback = $scope.headerLabelCallback || function(column) {
					return column;
				};
				
				// operationsMode
				$scope.operationsMode = $scope.operationsMode || $scope.OPERATIONS_MODE_VIEW;
				
				// rowSortEnabled
				$scope.rowSortEnabled =
					(angular.isDefined($scope.rowSortEnabled)) ?
						$scope.rowSortEnabled : false;
				
				// rowSortCriteria
				$scope.rowSortCriteria =
					$scope.rowSortCriteria ||
					((angular.isDefined($scope.rows) && angular.isDefined($scope.rows[0])) ?
						Object.keys($scope.rows[0])[0] : null);
				
				$scope.isSortCriteria = function(key) {
					var criteria =
						(angular.isDefined($scope.rowSortCriteria)) ?
							$scope.rowSortCriteria : null;
					if (criteria !== null && (criteria[0] === '+' || criteria[0] === '-')) {
						criteria = criteria.substr(1);
					}
					return (key === criteria);
				};
				
				// rowSortOrderAscending
				$scope.rowSortOrderAscending =
					(angular.isDefined($scope.rowSortOrderAscending)) ?
						$scope.rowSortOrderAscending : true;
				
				// actionList
				$scope.actionList = $scope.actionList || [];
				
				// cellRenderer
				$scope.cellRenderer = $scope.cellRenderer || function(row, column) {
					return angular.isDefined(row[column]) ? row[column] : null;
				};
				
				// columnClassCallback
				$scope.columnClassCallback = $scope.columnClassCallback || function() {
					// parameters: row, column, isHeader
					return '';
				};
				
				// pager
				var defaultPager = {};
				defaultPager[$scope.PAGER_TOTAL] = angular.isArray($scope.rows) ? $scope.rows.length : 0;
				defaultPager[$scope.PAGER_LIMIT] = angular.isArray($scope.rows) ? $scope.rows.length : 0;
				defaultPager[$scope.PAGER_OFFSET] = 0;
				$scope.pager = $scope.pager || defaultPager;
				$scope.pages = [];
				$scope.currentPage = 0;
				
				var resetPager = function() {
					if (angular.isDefined($scope.pager) && ($scope.pager !== null)) {
						
						// update pager
						if ($scope.operationsMode === $scope.OPERATIONS_MODE_VIEW) {
							var rows = $scope.rows || [];
							var rowsLength = $filter('filter')(rows, $scope.search).length;
							$scope.pager[$scope.PAGER_TOTAL] = rowsLength;
							if ($scope.pager[$scope.PAGER_OFFSET] > rowsLength - 1) {
								$scope.pager[$scope.PAGER_OFFSET] = 0;
							}
						}
						
						// determine array of pages
						if (angular.isNumber($scope.pager[$scope.PAGER_TOTAL]) &&
							angular.isNumber($scope.pager[$scope.PAGER_LIMIT])) {
							$scope.pages = [];
							var numOfPages = Math.ceil($scope.pager[$scope.PAGER_TOTAL] / $scope.pager[$scope.PAGER_LIMIT]);
							for (var i = 0; i &lt; numOfPages; i++) {
								$scope.pages.push(i + 1);
							}
						}
						
						// determine current page
						if (angular.isNumber($scope.pager[$scope.PAGER_LIMIT]) &&
							angular.isNumber($scope.pager[$scope.PAGER_OFFSET])) {
							$scope.currentPage =
								Math.floor($scope.pager[$scope.PAGER_OFFSET] / $scope.pager[$scope.PAGER_LIMIT]) + 1;
						}
						
					}
				};
				
				$scope.$watch('pager', function(newValue, oldValue) {
					if (newValue !== null && newValue !== oldValue) {
						resetPager();
					}
				}, true);
				
				$scope.$watch('search', function(newValue, oldValue) {
					if (newValue !== null && newValue !== oldValue) {
						resetPager();
					}
				});
				
				resetPager();
				
				// search
				$scope.search = $scope.search || null;
				
				// ACTIONS ---
				
				$scope.sortBy = function(column) {
					if ($scope.rowSortEnabled && $scope.headerLabelCallback(column) !== null) {
						if ($scope.rowSortCriteria === column) {
							$scope.rowSortOrderAscending = !$scope.rowSortOrderAscending;
						} else {
							$scope.rowSortCriteria = column;
						}
					}
				};
				
				$scope.selectedColumn = null;
				
				var resetSelectedColumn = function() {
					var possibleColumns = $filter('filter')($scope.switchableColumns, $scope.filterColumns);
					if (!inArray(possibleColumns, $scope.selectedColumn)) {
						$scope.selectedColumn = (angular.isDefined(possibleColumns[0])) ? possibleColumns[0] : null;
					}
				};
				
				$scope.$watch('switchableColumns.length', function(newValue, oldValue) {
					if (newValue !== null && newValue !== oldValue) {
						resetSelectedColumn();
					}
				});
				
				$scope.filterColumns = function(column) {
					return !inArray($scope.visibleColumns, column);
				};
				
				$scope.addColumn = function(column) {
					$scope.visibleColumns.push(column);
					resetSelectedColumn();
				};
				
				$scope.removeColumn = function(column) {
					var columns = [];
					angular.forEach($scope.visibleColumns, function(col) {
						if (col !== column) {
							columns.push(col);
						}
					});
					$scope.visibleColumns = columns;
					resetSelectedColumn();
				};
				
				$scope.goToPage = function(page) {
					$scope.pager[$scope.PAGER_OFFSET] = $scope.pager[$scope.PAGER_LIMIT] * (page - 1);
					resetPager();
				};
				
			}
		};
	});
</code></pre>
        </article>
    </section>




	</div>
	
	<script src="/keta/js/prettify.js"></script>
	<script src="/keta/js/lang-css.js"></script>
	<script> prettyPrint(); </script>
	<script src="/keta/js/linenumber.js"></script>
</body>
</html>